<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/study-notes/favicon.ico"><title>瓢儿白施肥记</title><meta name="description" content="记录一些学习内容">
    <link rel="preload" href="/study-notes/assets/style-BRJf4XC4.css" as="style"><link rel="stylesheet" href="/study-notes/assets/style-BRJf4XC4.css">
    <link rel="modulepreload" href="/study-notes/assets/app-D9fezM6y.js"><link rel="modulepreload" href="/study-notes/assets/index.html-qTUlGD2e.js">
    <link rel="prefetch" href="/study-notes/assets/index.html-CgflfRB-.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-B34h2Jk0.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BW535v_e.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DIHIQiSf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DZrbXYrC.js" as="script"><link rel="prefetch" href="/study-notes/assets/01.html-BO8Xsva7.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-CA0yKzuK.js" as="script"><link rel="prefetch" href="/study-notes/assets/continuous.html-5GavGPKu.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-CGg8PqqT.js" as="script"><link rel="prefetch" href="/study-notes/assets/matrix.html-C16KO3iA.js" as="script"><link rel="prefetch" href="/study-notes/assets/01.html-Bh2SeMAK.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-cZg359Qk.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DhRP-Ntg.js" as="script"><link rel="prefetch" href="/study-notes/assets/ali-iconfont.html-i0CTIv7W.js" as="script"><link rel="prefetch" href="/study-notes/assets/git.html-dcHlXWOR.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BzJzfHoY.js" as="script"><link rel="prefetch" href="/study-notes/assets/json-server.html-B5fTSOrf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BwhrVZQ1.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-Dw2Gd7a9.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BplpYS6e.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-Bl-LRITq.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-GHCF7Flf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BDNACifz.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DpTa0yfy.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BtM3uTMl.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-C-iDq3MW.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DtSplwMN.js" as="script"><link rel="prefetch" href="/study-notes/assets/404.html-C3r3GZUB.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/study-notes/"><img class="vp-site-logo" src="/study-notes/imgs/logo.png" alt="瓢儿白施肥记"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">瓢儿白施肥记</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数学"><span class="title">数学</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数学"><span class="title">数学</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/wzw/" aria-label="最优化：建模、算法与理论"><!--[--><!--[--><!--]--><!--]-->最优化：建模、算法与理论<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/eg/" aria-label="英语表达"><!--[--><!--[--><!--]--><!--]-->英语表达<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="通用"><span class="title">通用</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="通用"><span class="title">通用</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/tool/" aria-label="工具"><!--[--><!--[--><!--]--><!--]-->工具<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/ui/" aria-label="UI"><!--[--><!--[--><!--]--><!--]-->UI<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/frontend/" aria-label="前端"><!--[--><!--[--><!--]--><!--]-->前端<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/study-notes/general/backend/" aria-label="后端"><!--[--><!--[--><!--]--><!--]-->后端<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/carla-cn" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数学"><span class="title">数学</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数学"><span class="title">数学</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/wzw/" aria-label="最优化：建模、算法与理论"><!--[--><!--[--><!--]--><!--]-->最优化：建模、算法与理论<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/eg/" aria-label="英语表达"><!--[--><!--[--><!--]--><!--]-->英语表达<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="通用"><span class="title">通用</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="通用"><span class="title">通用</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/tool/" aria-label="工具"><!--[--><!--[--><!--]--><!--]-->工具<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/ui/" aria-label="UI"><!--[--><!--[--><!--]--><!--]-->UI<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/frontend/" aria-label="前端"><!--[--><!--[--><!--]--><!--]-->前端<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/study-notes/general/backend/" aria-label="后端"><!--[--><!--[--><!--]--><!--]-->后端<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/carla-cn" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h2 id="go" tabindex="-1"><a class="header-anchor" href="#go"><span>Go</span></a></h2><p>编译型语言</p><p>Go 是静态类型语言，一旦某个变量被声明，那么它的类型就无法再改变了</p><h3 id="搭建环境" tabindex="-1"><a class="header-anchor" href="#搭建环境"><span>搭建环境</span></a></h3><p>VSCode：</p><ol><li><p>插件：Go</p></li><li><p>ctrl + shift + p： <code>Go install/update tools</code></p><p>Go 代理</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on</span>
<span class="line">go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></li></ol><p>GoLand:</p><ol><li>Keymap：<code>Eclipse</code></li></ol><ul><li>alt + 左/右方向键 == 切换文件</li><li>ctrl + d == 删除单行</li></ul><h3 id="hello-world" tabindex="-1"><a class="header-anchor" href="#hello-world"><span>hello world</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>同一个目录下最好只有一个 main 函数</li><li>go build 文件 =&gt; 生成 .exe 文件，可直接在终端执行</li><li>go run 文件 =&gt; 执行</li></ol></div><h3 id="变量、常量及其作用域" tabindex="-1"><a class="header-anchor" href="#变量、常量及其作用域"><span>变量、常量及其作用域</span></a></h3><p>作用域的范围就是 {} 之间的部分</p><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>变量必须先定义才能使用，且不使用会编译报错，但匿名变量 <code>_</code> 除外；常量没有必须使用的要求</li><li>go 是静态语言，要求变量/常量的类型和赋值类型一致</li><li>命名不能冲突，常量建议使用全大写</li><li>main 函数外声明的变量拥有 package 作用域，短声明不能用来声明 package 作用域的变量</li><li>变量有零值，常量在声明时赋值</li><li>常量类型只可以定义 bool、数值（整数、浮点数和复数）、字符串</li></ol></div><details class="hint-container details"><summary>定义常量</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">const</span> ct <span class="token builtin">float32</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">		a <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">		b</span>
<span class="line">		c <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span></span>
<span class="line">		d</span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">// 1 1 abc abc</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">/*</span>
<span class="line">	* 特殊常量 iota</span>
<span class="line">	* - iota 自增类型默认是 int，初始值为 0，且在 const 定义中计数器会在每定义一个变量时计数一次</span>
<span class="line">	* - 每次出现 const 时，iota 初始化为 0</span>
<span class="line">	*/</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">const</span> <span class="token punctuation">(</span></span>
<span class="line">		ERR1 <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span></span>
<span class="line">		ERR15</span>
<span class="line">		ERR2 <span class="token operator">=</span> <span class="token boolean">iota</span></span>
<span class="line">		ERR3</span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">const</span> ERR <span class="token operator">=</span> <span class="token boolean">iota</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ERR<span class="token punctuation">,</span> ERR1<span class="token punctuation">,</span> ERR2<span class="token punctuation">,</span> ERR3<span class="token punctuation">)</span> <span class="token comment">// 0 abc 2 3</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></details><details class="hint-container details"><summary>定义变量</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 全局变量</span></span>
<span class="line"><span class="token keyword">var</span> globalAge <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> initial <span class="token builtin">int</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span></span>
<span class="line">	age <span class="token operator">:=</span> <span class="token number">18</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">		user1 <span class="token operator">=</span> <span class="token string">&quot;abc1&quot;</span></span>
<span class="line">		user2 <span class="token operator">=</span> <span class="token string">&quot;abc2&quot;</span></span>
<span class="line">		user3 <span class="token operator">=</span> <span class="token number">007</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>user1<span class="token punctuation">,</span> user2<span class="token punctuation">,</span> user3<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">var</span> num<span class="token punctuation">,</span> str<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;abcstr&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> str<span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></details><details class="hint-container details"><summary>短声明</summary><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 使用 var 声明变量</span></span>
<span class="line"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"><span class="token comment">// 也可以使用短声明，效果同上，但可以在无法使用 var 的地方使用</span></span>
<span class="line">a <span class="token operator">:=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment">// i 在 for 循环中声明，作用域只在 for 循环中</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> a <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> a <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment">// a 在 if 语句中声明，作用域只在 if 语句中</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">switch</span> a <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> a <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token comment">// a 在 switch 语句中声明，作用域只在 switch 语句中</span></span>
<span class="line"><span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token comment">//...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></details><h3 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型"><span>数据类型</span></a></h3><h4 id="bool" tabindex="-1"><a class="header-anchor" href="#bool"><span>bool</span></a></h4><p>零值是 false</p><p>Print 家族函数，会把 bool 类型的值打印成 true/false 文本</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">launch <span class="token operator">:=</span> <span class="token boolean">false</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Type %T from %[1]v\n&quot;</span><span class="token punctuation">,</span> launch<span class="token punctuation">)</span></span>
<span class="line">launchText <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%v&quot;</span><span class="token punctuation">,</span> launch<span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Ready for launch:&quot;</span><span class="token punctuation">,</span> launchText<span class="token punctuation">)</span> <span class="token comment">// Ready for launch: false</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> yesNo <span class="token builtin">string</span></span>
<span class="line"><span class="token keyword">if</span> launch <span class="token punctuation">{</span></span>
<span class="line">   yesNo <span class="token operator">=</span> <span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">   yesNo <span class="token operator">=</span> <span class="token string">&quot;no&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Ready for launch:&quot;</span><span class="token punctuation">,</span> yesNo<span class="token punctuation">)</span> <span class="token comment">// Ready for launch: no</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>布尔数据类型仅表示 true 或 false。布尔类型的值不会隐式或显式转换为任何其他类型</p><p>如果想使用 string(false)，int(false)；bool(1), bool(&quot;yes&quot;) 等类似的方法进行转换，那么 Go 编译器会报错</p><h4 id="字符和-string" tabindex="-1"><a class="header-anchor" href="#字符和-string"><span>字符和 string</span></a></h4><p>字符串的零值 &quot;&quot;</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> empty <span class="token builtin">string</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>empty <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>声明</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">peace <span class="token operator">:=</span> <span class="token string">&quot;peace&quot;</span></span>
<span class="line"><span class="token keyword">var</span> peace <span class="token operator">=</span> <span class="token string">&quot;peace&quot;</span></span>
<span class="line"><span class="token keyword">var</span> peace <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;peace&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="字符串字面值-原始字符串字面值" tabindex="-1"><a class="header-anchor" href="#字符串字面值-原始字符串字面值"><span>字符串字面值/原始字符串字面值</span></a></h5><p>字符串字面值（string literal）可以包含转义字符，例如 \n</p><p>但如果想得到 \n 而不是换行的话，可以使用 ` 来代替 &quot;，这叫做原始字符串字面值（raw string literal）</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;peace be upon you\nupon you be peace&quot;</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">`strings can span multiple lines with the \n escape sequence`</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">`</span>
<span class="line">peace be upon you</span>
<span class="line">upon you be peace</span>
<span class="line">`</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="字符-code-points-runes-bytes" tabindex="-1"><a class="header-anchor" href="#字符-code-points-runes-bytes"><span>字符，code points，runes，bytes</span></a></h5><p>Unicode 联盟为超过 100 万个字符分配了相应的数值，这个数叫做 code point</p><ul><li>例如：65 代表 A，128515 代表 😃</li></ul><p>为了表示这样的 unicode code point，Go 提供了 rune 类型，它是 int32 的别名</p><p>byte 是 unit 8 类型的别名，目的是用于二进制数据</p><ul><li>byte 倒是可以表示由 ASCII 定义的英语字符，它是 Unicode 的一个子集（共 128 个字符）</li></ul><h5 id="类型别名" tabindex="-1"><a class="header-anchor" href="#类型别名"><span>类型别名</span></a></h5><p>类型别名就是同一个类型的另一个名字</p><ul><li>所以，rune 和 int32 可以互换使用</li></ul><p>也可以自定义类型别名，语法如下</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token builtin">uint8</span></span>
<span class="line"><span class="token keyword">type</span> <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token builtin">int32</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="打印" tabindex="-1"><a class="header-anchor" href="#打印"><span>打印</span></a></h5><p>如果想打印字符而不是数值，使用 c% 格式化动词</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c&quot;</span><span class="token punctuation">,</span> <span class="token number">128515</span><span class="token punctuation">)</span> <span class="token comment">// 😃</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>任何整数类型都可以使用 %c 打印，但是 rune 意味着该数值表示了一个字符</p><h5 id="字符串拼接" tabindex="-1"><a class="header-anchor" href="#字符串拼接"><span>字符串拼接</span></a></h5><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	userName <span class="token operator">:=</span> <span class="token string">&quot;bobby&quot;</span></span>
<span class="line">	age <span class="token operator">:=</span> <span class="token number">18</span></span>
<span class="line">	address <span class="token operator">:=</span> <span class="token string">&quot;北京&quot;</span></span>
<span class="line">	mobile <span class="token operator">:=</span> <span class="token string">&quot;13512345678&quot;</span></span>
<span class="line">	<span class="token comment">/**</span>
<span class="line">	* 字符串拼接</span>
<span class="line">	* - Printf 和 Sprintf 性能最差，但可读性好更常用</span>
<span class="line">	* - + 连接性能较好，可读性差</span>
<span class="line">	* - 通过字符串的 builder 进行字符串拼接，性能远高于上述方式</span>
<span class="line">	 */</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;用户名：&quot;</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">&quot;，年龄：&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;，地址：&quot;</span> <span class="token operator">+</span> address <span class="token operator">+</span> <span class="token string">&quot;，电话：&quot;</span> <span class="token operator">+</span> mobile<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;用户名：%s，年龄：%d，地址：%s，电话：%s\n&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> mobile<span class="token punctuation">)</span></span>
<span class="line">	s <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;用户名：%s，年龄：%d，地址：%s，电话：%s&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">,</span> age<span class="token punctuation">,</span> address<span class="token punctuation">,</span> mobile<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//	通过字符串的 builder 进行字符串拼接</span></span>
<span class="line">	<span class="token keyword">var</span> builder strings<span class="token punctuation">.</span>Builder</span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;用户名：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;，年龄：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;，地址：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;，电话：&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	builder<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="字符" tabindex="-1"><a class="header-anchor" href="#字符"><span>字符</span></a></h5><p>字符字面值使用 &#39;&#39; 括起来，例如 &#39;A&#39;</p><p>如果没有指定字符类型的话，Go 会推断它的类型为 rune</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">grade <span class="token operator">:=</span> <span class="token char">&#39;A&#39;</span></span>
<span class="line"><span class="token keyword">var</span> grade1 <span class="token operator">=</span> <span class="token char">&#39;A&#39;</span></span>
<span class="line"><span class="token keyword">var</span> grade2 <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token char">&#39;A&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>这里的 grade 仍然包含一个数值，本例中就是 65，它是 A 的 code point</p></blockquote><p>字符字面值也可以用 byte 类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> star <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="string" tabindex="-1"><a class="header-anchor" href="#string"><span>string</span></a></h5><p>可以给某个变量赋予不同的 string 值，但是 string 本身是不可变的</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">message <span class="token operator">:=</span> <span class="token string">&quot;shalom&quot;</span></span>
<span class="line">c <span class="token operator">:=</span> message<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c\n&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token comment">// m</span></span>
<span class="line">message<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&#39;d&#39;</span> <span class="token comment">// 报错</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="caesar-cipher-凯撒加密法" tabindex="-1"><a class="header-anchor" href="#caesar-cipher-凯撒加密法"><span>Caesar cipher 凯撒加密法</span></a></h5><p>凯撒加密法是一种简单的加密方法，它是通过将每个字符移动固定数目的位置来实现的</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">c <span class="token operator">:=</span> <span class="token char">&#39;a&#39;</span></span>
<span class="line">c <span class="token operator">=</span> c <span class="token operator">+</span> <span class="token number">3</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token comment">// d</span></span>
<span class="line"><span class="token keyword">if</span> c <span class="token operator">&gt;</span> <span class="token char">&#39;z&#39;</span> <span class="token punctuation">{</span></span>
<span class="line">  c <span class="token operator">=</span> c <span class="token operator">-</span> <span class="token number">26</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="rot13" tabindex="-1"><a class="header-anchor" href="#rot13"><span>ROT13</span></a></h5><p>ROT13 (旋转 13) 是凯撒加密在 20 世纪的变体, 它会把字母替换成 +13 后对应的字母</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">originalMessage <span class="token operator">:=</span> <span class="token string">&quot;uv vagreangvbany fcnpr fgngvba&quot;</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>originalMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">  c <span class="token operator">:=</span> originalMessage<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">  <span class="token keyword">if</span> c <span class="token operator">&gt;=</span> <span class="token char">&#39;a&#39;</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token char">&#39;z&#39;</span> <span class="token punctuation">{</span></span>
<span class="line">    c <span class="token operator">=</span> c <span class="token operator">+</span> <span class="token number">13</span></span>
<span class="line">    <span class="token keyword">if</span> c <span class="token operator">&gt;</span> <span class="token char">&#39;z&#39;</span> <span class="token punctuation">{</span></span>
<span class="line">      c <span class="token operator">=</span> c <span class="token operator">-</span> <span class="token number">26</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="go-的内置函数-len" tabindex="-1"><a class="header-anchor" href="#go-的内置函数-len"><span>Go 的内置函数 len</span></a></h5><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">message <span class="token operator">:=</span> <span class="token string">&quot;uv vagreangvbany fcnpr fgngvba&quot;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 32</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>本例中 len 返回 message 所占的 byte 数</p></blockquote><h5 id="utf-8" tabindex="-1"><a class="header-anchor" href="#utf-8"><span>UTF-8</span></a></h5><p>Go 中的字符串是用 UTF-8 编码的，UTF-8 是 Unicode Code Point 的几种编码之一</p><p>UTF8 是一种有效率的可变长度的编码，每个 code point 可以是 8 位、16 位或 32 位的</p><p>通过使用可变长度编码，UTF-8 使得从 ASCII 的转换变得简单明了，因为 ASCII 字符与其 UTF-8 编码对应的字符是相同的</p><p>UTF-8 是万维网的主要字符编码，它是由 Ken Thompson（Go 语言的设计者之一） 于 1992 年发明的</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;unicode/utf8&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">/*</span>
<span class="line">	* 字符字节</span>
<span class="line">	 */</span></span>
<span class="line">	s <span class="token operator">:=</span> <span class="token string">&quot;Yes我爱慕课网!&quot;</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x &quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// 59 65 73 e6 88 91 e7 88 b1 e6 85 95 e8 af be e7 bd 91 21</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i<span class="token punctuation">,</span> ch <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span> <span class="token comment">// ch is a rune</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%d %x) &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> ch<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// (0 59) (1 65) (2 73) (3 6211) (6 7231) (9 6155) (12 8bfe) (15 7f51) (18 21)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">/*</span>
<span class="line">	* byte 数和 rune 数</span>
<span class="line">	 */</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;byte 数是&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token comment">// byte 数是 19</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;rune 数是&quot;</span><span class="token punctuation">,</span> utf8<span class="token punctuation">.</span><span class="token function">RuneCountInString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// rune 数是 9</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">/**</span>
<span class="line">	* 打印每个 rune</span>
<span class="line">	 */</span></span>
<span class="line">	bytes <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token function">len</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		r<span class="token punctuation">,</span> size <span class="token operator">:=</span> utf8<span class="token punctuation">.</span><span class="token function">DecodeRune</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span></span>
<span class="line">		bytes <span class="token operator">=</span> bytes<span class="token punctuation">[</span>size<span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c &quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// Y e s 我 爱 慕 课 网 !</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">for</span> i<span class="token punctuation">,</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;(%d %c) &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> r<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token comment">// (0 Y) (1 e) (2 s) (3 我) (4 爱) (5 慕) (6 课) (7 网) (8 !)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>示例：寻找最长不含有重复字符的子串</strong></p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">lengthOfNonRepeatingSubStr</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	lastOccurred <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">	start <span class="token operator">:=</span> <span class="token number">0</span></span>
<span class="line">	maxLength <span class="token operator">:=</span> <span class="token number">0</span></span>
<span class="line">	<span class="token keyword">for</span> i<span class="token punctuation">,</span> ch <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> lastI<span class="token punctuation">,</span> ok <span class="token operator">:=</span> lastOccurred<span class="token punctuation">[</span>ch<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token operator">&amp;&amp;</span> lastI <span class="token operator">&gt;=</span> start <span class="token punctuation">{</span></span>
<span class="line">			start <span class="token operator">=</span> lastI <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">if</span> i<span class="token operator">-</span>start<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&gt;</span> maxLength <span class="token punctuation">{</span></span>
<span class="line">			maxLength <span class="token operator">=</span> i <span class="token operator">-</span> start <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		lastOccurred<span class="token punctuation">[</span>ch<span class="token punctuation">]</span> <span class="token operator">=</span> i</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> maxLength</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">lengthOfNonRepeatingSubStr</span><span class="token punctuation">(</span><span class="token string">&quot;一二三一二&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="strings" tabindex="-1"><a class="header-anchor" href="#strings"><span>strings</span></a></h5><p>字符串常见操作：</p><ul><li>Fields / Split / Join</li><li>Contains / Index</li><li>ToLower / ToUpper</li><li>Trim/TrimLeft / TrimRight</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strings&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	name <span class="token operator">:=</span> <span class="token string">&quot;imooc体系课-go工程师&quot;</span></span>
<span class="line">	<span class="token comment">//	是否包含</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line">	<span class="token comment">//	出现次数</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span></span>
<span class="line">	<span class="token comment">//	分割字符串</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [imooc体系课 go工程师]</span></span>
<span class="line">	<span class="token comment">//	字符串是否包含前缀/后缀</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;imooc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;工程师&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// true</span></span>
<span class="line">	<span class="token comment">//	查找字串出现的位置</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 15（字节的位置）</span></span>
<span class="line">	<span class="token comment">//	字串替换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// imooc体系课-java工程师</span></span>
<span class="line">	<span class="token comment">//	大小写转换</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token string">&quot;go&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// GO</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token string">&quot;JAVA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// java</span></span>
<span class="line">	<span class="token comment">//	去掉特殊字符</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token string">&quot;#$hello#go#&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello#go</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="数值类型" tabindex="-1"><a class="header-anchor" href="#数值类型"><span>数值类型</span></a></h4><p>零值是 0</p><h5 id="整数" tabindex="-1"><a class="header-anchor" href="#整数"><span>整数</span></a></h5><p>Go 提供了 10 种整数类型（不可以存小数部分，范围有限，通常根据数值范围来选取整数类型）</p><ul><li>5 种整数类型是有符号的，能表示正数、0、负数</li><li>5 种整数类型是无符号的，能表示正数、0</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 最常用的整数类型是 int</span></span>
<span class="line"><span class="token keyword">var</span> year <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2018</span></span>
<span class="line"><span class="token comment">// 无符号整数类型是 uint</span></span>
<span class="line"><span class="token keyword">var</span> month <span class="token builtin">uint</span> <span class="token operator">=</span> <span class="token number">12</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>下面三个语句是等价的：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">year <span class="token operator">:=</span> <span class="token number">2018</span></span>
<span class="line"><span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token number">2018</span></span>
<span class="line"><span class="token keyword">var</span> year <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">2018</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>int 和 uint 是针对目标设备优化的类型</p><ul><li>在树莓派 2、比较老的移动设备上，int 和 int32 都是 32 位的</li><li>在比较新的计算机上，int 和 int64 都是 64 位的</li></ul><blockquote><p>如果在比较老的 32 位设备上，使用了超过 20 亿的整数，并且代码还能运行，那么最好使用 int64 和 uint64 来代替 int 和 uint</p></blockquote><h6 id="uint8" tabindex="-1"><a class="header-anchor" href="#uint8"><span>uint8</span></a></h6><p>取值范围 0-255</p><ul><li>unit8 可以用来表示 8 位的颜色（红绿蓝：0-255）<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue unit8 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">213</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></li></ul><h6 id="十六进制表示法" tabindex="-1"><a class="header-anchor" href="#十六进制表示法"><span>十六进制表示法</span></a></h6><p>Go 语言里，在数前面加上 <code>0x</code> 前缀，就可以用十六进制的形式来表示</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue unit8 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">213</span></span>
<span class="line"><span class="token keyword">var</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue unit8 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x8d</span><span class="token punctuation">,</span> <span class="token number">0xd5</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>打印十六进制</strong></p><p>打印十六进制的数，用 <code>%x</code> 格式化动词</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%x %x %x&quot;</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 也可以指定最小宽度和填充</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;color: #%02x%02x%02x;&quot;</span><span class="token punctuation">,</span> red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h6 id="整数环绕" tabindex="-1"><a class="header-anchor" href="#整数环绕"><span>整数环绕</span></a></h6><p>所有的整数都有一个取值范围，超出这个范围，就会发生“环绕”</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> red <span class="token builtin">uint8</span> <span class="token operator">=</span> <span class="token number">255</span></span>
<span class="line">red<span class="token operator">++</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>red<span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> number <span class="token builtin">int8</span> <span class="token operator">=</span> <span class="token number">127</span></span>
<span class="line">number<span class="token operator">++</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token comment">// -128</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>如何避免时间发生环绕？</p><p>Unix 系统里，时间是以 1970 年 1 月 1 日至今的秒数来表示的</p><p>但是在 2038 年，这个数就会超过 20 多亿，也就是超过了 int32 的范围</p><p>应使用：int64 或 uint64</p></blockquote><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">future <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token number">12622780800</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span> <span class="token comment">// 2370-01-01 08:00:00 +0800 CST</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h6 id="打印每个-bit" tabindex="-1"><a class="header-anchor" href="#打印每个-bit"><span>打印每个 bit</span></a></h6><p>使用 %b 格式化动词</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> green <span class="token builtin">uint8</span> <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span> <span class="token comment">// 00000011</span></span>
<span class="line">green<span class="token operator">++</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%08b\n&quot;</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span> <span class="token comment">// 00000100</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h6 id="整数类型的最大值、最小值" tabindex="-1"><a class="header-anchor" href="#整数类型的最大值、最小值"><span>整数类型的最大值、最小值</span></a></h6><ul><li>math 包里，为与架构无关的整数类型，定义了最大、最小值常量<div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">math<span class="token punctuation">.</span>MaxInt16</span>
<span class="line">math<span class="token punctuation">.</span>MinInt64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></li><li>而 int 和 uint，可能是 32 位 或 64 位的</li></ul><h5 id="浮点数" tabindex="-1"><a class="header-anchor" href="#浮点数"><span>浮点数</span></a></h5><p>只要数字含有小数部分，那么它的类型就是 <code>float64</code></p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">/* 下面三个语句的效果是一样的 */</span></span>
<span class="line">days <span class="token operator">:=</span> <span class="token number">365.2425</span></span>
<span class="line"><span class="token keyword">var</span> days <span class="token operator">=</span> <span class="token number">365.2425</span></span>
<span class="line"><span class="token keyword">var</span> days <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">365.2425</span></span>
<span class="line"><span class="token comment">/* 如果使用一个整数来初始化某个变量，则必须指定它的类型为 float64，否则它就是一个整数类型 */</span></span>
<span class="line"><span class="token keyword">var</span> answer <span class="token builtin">float32</span> <span class="token operator">=</span> <span class="token number">42</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>Go 语言里有两种浮点数类型：</p><p><strong>默认是 float64</strong></p><ul><li>64 位的浮点类型</li><li>占用 8 字节，大约 1.8e308</li></ul><p><strong>float32</strong></p><ul><li>占用 4 字节，大约 3.4e38</li><li>精度比 float64 低</li><li>有时叫做单精度浮点数类型</li></ul></div><p>想使用单精度类型，必须再声明变量的时候指定该类型：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> pi64 <span class="token operator">=</span> math<span class="token punctuation">.</span>Pi</span>
<span class="line"><span class="token keyword">var</span> pi32 <span class="token builtin">float32</span> <span class="token operator">=</span> math<span class="token punctuation">.</span>Pi</span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>pi64<span class="token punctuation">)</span> <span class="token comment">// 3.141592653589793</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>pi32<span class="token punctuation">)</span> <span class="token comment">// 3.1415927</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>当处理大量数据时，例如 3D 游戏中的数千个顶点，使用 float32 牺牲精度来节省内存是很有意义的</li><li>math 包里面的函数操作都是 float64 类型，所以应该首选使用 float 64 类型，除非有足够的理由不去使用它</li></ul><h6 id="打印浮点类型" tabindex="-1"><a class="header-anchor" href="#打印浮点类型"><span>打印浮点类型</span></a></h6><ul><li>Print 或 Println 打印浮点类型的时候，默认的行为是尽可能地多显示几位小数</li><li>Printf 函数，结合 %f 格式化动词来指定显示小数的位数</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">third <span class="token operator">:=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>third<span class="token punctuation">)</span> <span class="token comment">// 0.3333333333333333</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">)</span> <span class="token comment">// 0.3333333333333333</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%f\n&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">)</span> <span class="token comment">// 0.333333</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.3f\n&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">)</span> <span class="token comment">// 0.333</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%4.2f\n&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">)</span> <span class="token comment">// 0.33</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%05.2f\n&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">)</span> <span class="token comment">// 00.33，默认是空格填充</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>浮点类型不适合用于金融类计算，为了尽量最小化舍入错误，建议先做乘法，再做除法</p></blockquote><h6 id="如何比较浮点类型" tabindex="-1"><a class="header-anchor" href="#如何比较浮点类型"><span>如何比较浮点类型</span></a></h6><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">piggyBank <span class="token operator">:=</span> <span class="token number">0.1</span></span>
<span class="line">piggyBank <span class="token operator">+=</span> <span class="token number">0.2</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>piggyBank <span class="token operator">==</span> <span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment">// false</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>piggyBank <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.0001</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="复数" tabindex="-1"><a class="header-anchor" href="#复数"><span>复数</span></a></h5><p>将复数分为两部分，如下表所示。float32和float64也是这些复数的一部分。内建函数从它的虚部和实部创建一个复数，内建虚部和实部函数提取这些部分</p><ul><li>complex64 包含float32作为实数和虚数分量的复数。</li><li>complex128 包含float64作为实数和虚数分量的复数。</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main </span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span></span>
<span class="line">  </span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span>
<span class="line">      </span>
<span class="line">   <span class="token keyword">var</span> a <span class="token builtin">complex128</span> <span class="token operator">=</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> </span>
<span class="line">   <span class="token keyword">var</span> b <span class="token builtin">complex64</span> <span class="token operator">=</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> </span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// (6+2i)</span></span>
<span class="line">   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// (9+2i)</span></span>
<span class="line">     </span>
<span class="line">   <span class="token comment">//显示类型 </span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;a的类型是 %T 以及&quot;</span><span class="token operator">+</span> <span class="token string">&quot;b的类型是 %T&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// a的类型是 complex128 以及b的类型是 complex64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="比较大的数" tabindex="-1"><a class="header-anchor" href="#比较大的数"><span>比较大的数</span></a></h3><p>浮点类型可以存储非常大的数值，但是精度不高</p><p>整型很精确，但是取值范围有限</p><p>使用指数表示的数，默认就是 float64 类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> distance <span class="token operator">=</span> <span class="token number">24e2</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T&quot;</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span> <span class="token comment">// float64</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>如果需要存储非常大的整数，可以使用 math/big 包</p><ul><li>对于比较大的整数（超过 10^18），big.Int</li><li>对于任意精度的浮点类型，big.Float</li><li>对于分数，big.Rat</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">lightSpeed <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">299792</span><span class="token punctuation">)</span></span>
<span class="line">secondsPerDay <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">86400</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">distance <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Int<span class="token punctuation">)</span></span>
<span class="line">distance<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;24000000000000000000000&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span> <span class="token comment">// 24000000000000000000000</span></span>
<span class="line"></span>
<span class="line">seconds <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Int<span class="token punctuation">)</span></span>
<span class="line">seconds<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>distance<span class="token punctuation">,</span> lightSpeed<span class="token punctuation">)</span> <span class="token comment">// seconds = distance / lightSpeed</span></span>
<span class="line"></span>
<span class="line">days <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Int<span class="token punctuation">)</span></span>
<span class="line">days<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>seconds<span class="token punctuation">,</span> secondsPerDay<span class="token punctuation">)</span> <span class="token comment">// days = seconds / secondsPerDay</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;That is&quot;</span><span class="token punctuation">,</span> days<span class="token punctuation">,</span> <span class="token string">&quot;days of travel at light speed.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>一旦使用了 big.Int，那么等式里其他部分也必须使用 big.Int</p><p>NewInt() 函数可以把 int64 转化为 big.Int 类型</p><p>缺点：用起来繁琐，速度较慢</p></blockquote><h4 id="较大数值的常量" tabindex="-1"><a class="header-anchor" href="#较大数值的常量"><span>较大数值的常量</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 会报错</span></span>
<span class="line"><span class="token keyword">const</span> distance unit64 <span class="token operator">=</span> <span class="token number">24000000000000000000000</span></span>
<span class="line"><span class="token comment">// 但在 Go 里面，常量是可以无类型的（untyped），下面就不会报错</span></span>
<span class="line"><span class="token keyword">const</span> distance <span class="token operator">=</span> <span class="token number">24000000000000000000000</span> <span class="token comment">// untyped int</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T&quot;</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span> <span class="token comment">// 报错</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>常量使用 const 关键字来声明，程序里每个字面值都是常量，这意味着比较大的数值可以直接使用（作为字面值）</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">24000000000000000000000</span><span class="token operator">/</span><span class="token number">299792</span><span class="token operator">/</span><span class="token number">86400</span><span class="token punctuation">)</span> <span class="token comment">// 926568346646</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>针对字面值和常量的计算是在编译阶段完成的</p><p>Go 的编译器是用 Go 编写的，这种无类型的数值字面值就是由 big 包所支持的，这使得可以操作很大的数（超过 18 的 10^18）</p></blockquote><h3 id="基本类型转换" tabindex="-1"><a class="header-anchor" href="#基本类型转换"><span>基本类型转换</span></a></h3><h4 id="类型不能混用" tabindex="-1"><a class="header-anchor" href="#类型不能混用"><span>类型不能混用</span></a></h4><p>连接两个字符串，使用 + 运算符</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown <span class="token operator">:=</span> <span class="token string">&quot;Launch in T minus &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;10 seconds.&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>如果想连接字符串和数值，是会报错的</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown <span class="token operator">:=</span> <span class="token string">&quot;Launch in T minus &quot;</span> <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">&quot; seconds.&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>整型和浮点类型也不能混着用</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">age <span class="token operator">:=</span> <span class="token number">41</span></span>
<span class="line">marsDays <span class="token operator">:=</span> <span class="token number">687</span></span>
<span class="line">earthDays <span class="token operator">:=</span> <span class="token number">365.2425</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am&quot;</span><span class="token punctuation">,</span> age <span class="token operator">*</span> earthDays <span class="token operator">/</span> marsDays<span class="token punctuation">,</span> <span class="token string">&quot;years old on Mars.&quot;</span><span class="token punctuation">)</span> <span class="token comment">// invalid operation: age * earthDays (mismatched types int and float64)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="类型转换" tabindex="-1"><a class="header-anchor" href="#类型转换"><span>类型转换</span></a></h4><h5 id="整数类型转换为浮点类型" tabindex="-1"><a class="header-anchor" href="#整数类型转换为浮点类型"><span>整数类型转换为浮点类型</span></a></h5><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">age <span class="token operator">:=</span> <span class="token number">41</span></span>
<span class="line"><span class="token comment">// 将 age 转换为浮点类型</span></span>
<span class="line">marsAge <span class="token operator">:=</span> <span class="token function">float64</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="浮点类型转换为整数类型-小数点后边的部分会被截断-而不是舍入" tabindex="-1"><a class="header-anchor" href="#浮点类型转换为整数类型-小数点后边的部分会被截断-而不是舍入"><span>浮点类型转换为整数类型，小数点后边的部分会被截断，而不是舍入</span></a></h5><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">earthDays <span class="token operator">:=</span> <span class="token number">365.2425</span></span>
<span class="line"><span class="token comment">// 将 earthDays 转换为整数类型</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>earthDays<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 365</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>无符号和有符号整数类型之间也需要转换</p><p>不同大小的整数类型之间也需要转换</p></blockquote><p><strong>类型转换时需谨慎</strong></p><p>环绕行为</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> bh <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">32768</span></span>
<span class="line"><span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token function">int16</span><span class="token punctuation">(</span>bh<span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token comment">// -32768</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>可以通过 math 包提供的 max、min 常量，来判断是否超过最大最小值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> bh <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">32768</span></span>
<span class="line"><span class="token keyword">if</span> bh <span class="token operator">&lt;</span> math<span class="token punctuation">.</span>MinInt16 <span class="token operator">||</span> bh <span class="token operator">&gt;</span> math<span class="token punctuation">.</span>MaxInt16 <span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment">// handle out of range error</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="把-rune、byte-转换为-string" tabindex="-1"><a class="header-anchor" href="#把-rune、byte-转换为-string"><span>把 rune、byte 转换为 string</span></a></h5><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> pi <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token number">960</span></span>
<span class="line"><span class="token keyword">var</span> alpha <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token number">940</span></span>
<span class="line"><span class="token keyword">var</span> omega <span class="token builtin">rune</span> <span class="token operator">=</span> <span class="token number">969</span></span>
<span class="line"><span class="token keyword">var</span> bang <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token number">33</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v %v %v %v\n&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>alpha<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>omega<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>bang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// π ά ω !</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>想把数值转化为有意义的字符串，它的值必须能转化为 code point</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown <span class="token operator">:=</span> <span class="token number">10</span></span>
<span class="line">str <span class="token operator">:=</span> <span class="token string">&quot;Launch in T minus &quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>countdown<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; seconds.&quot;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// Launch in T minus 10 seconds.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>Itoa 是 Integer to ASCII 的意思</p><p>Unicode 是 ASCII 的超集，它们前 128 个 code points 是一样的（数字、英文字母、常用标点）</p></blockquote><p>另外一种把数值转化为 string 的方式是使用 Sprintf 函数，和 Printf 略类似，但是会返回一个 string</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown <span class="token operator">:=</span> <span class="token number">9</span></span>
<span class="line">str <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Launch in T minus %v seconds.&quot;</span><span class="token punctuation">,</span> countdown<span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// Launch in T minus 9 seconds.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>strconv 包中的 Atoi 函数（ASCII to Integer），由于字符串里面可能包含任意字符，或者要转换的数字字符串太大，所以 Atoi 函数可能会发生错误</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">&quot;10ds&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// handle error</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// strconv.Atoi: parsing &quot;10ds&quot;: invalid syntax</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>countdown<span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h5 id="strconv" tabindex="-1"><a class="header-anchor" href="#strconv"><span>strconv</span></a></h5><p>常用的两个方法：</p><ul><li>strconv.Atoi</li><li>strconv.Itoa</li></ul><p>将其他基本类型 format 为 string 类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">iStr <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatInt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> iStr<span class="token punctuation">)</span> <span class="token comment">// -2a 是 string</span></span>
<span class="line"></span>
<span class="line">bStr <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatBool</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> bStr<span class="token punctuation">)</span> <span class="token comment">// true 是 string</span></span>
<span class="line"></span>
<span class="line">fStr <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">FormatFloat</span><span class="token punctuation">(</span><span class="token number">3.1415</span><span class="token punctuation">,</span> <span class="token char">&#39;E&#39;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> fStr<span class="token punctuation">)</span> <span class="token comment">// 3.1415E+00 是 string</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>将 string 类型 parse 为其他基本类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">i<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseInt</span><span class="token punctuation">(</span><span class="token string">&quot;-42&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// -66 是 int64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">b<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseBool</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// true 是 bool</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">f<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span><span class="token string">&quot;3.1415&quot;</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v 是 %[1]T\n&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token comment">// 3.1415 是 float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h3><p>使用 func 关键字</p><p>大写字母开头的函数、变量或其他标识符都会被导出，对其他包可用；小写字母开头的则不会</p><p>实参（argument）和形参（parameter）</p><p>函数声明时，如果多个形参类型相同，那么该类型只写一次即可：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// func Unix(sec int64, nsec int64) Time</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">Unix</span><span class="token punctuation">(</span>sec<span class="token punctuation">,</span> nsec <span class="token builtin">int64</span><span class="token punctuation">)</span> Time</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>Go 的函数可以返回多个值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">countdown<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>上面的函数声明为 <code>func Atoi(s string) (i int, err error)</code></p></blockquote><p>函数的多个返回值需要用括号括起来，每个返回值名字在前，类型在后。声明函数时可以把名字去掉，只保留类型：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Atoi</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>Println 是一个特殊的函数，它可以接收一个、两个甚至多个参数，参数类型还可以不同。其声明如下：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Println</span><span class="token punctuation">(</span>a <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p><code>...</code> 表示函数的参数数量是可变的</p><p>参数 <code>a</code> 的类型为 <code>interface{}</code>，是一个空接口</p></blockquote><p>编写函数</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">kelvinToCelsius</span><span class="token punctuation">(</span>k <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span></span>
<span class="line">  k <span class="token operator">-=</span> <span class="token number">273.15</span></span>
<span class="line">  <span class="token keyword">return</span> k</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  k <span class="token operator">:=</span> <span class="token number">294.0</span></span>
<span class="line">  c <span class="token operator">:=</span> <span class="token function">kelvinToCelsius</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">&quot;°K is&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">&quot;°C&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>函数按值传递</p><p>同一个包中声明的函数在调用时彼此不需要加上包名</p></blockquote><h3 id="方法" tabindex="-1"><a class="header-anchor" href="#方法"><span>方法</span></a></h3><h4 id="声明新类型" tabindex="-1"><a class="header-anchor" href="#声明新类型"><span>声明新类型</span></a></h4><p>关键字 type 用来声明新类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> celsius <span class="token builtin">float64</span></span>
<span class="line"><span class="token keyword">const</span> degrees <span class="token operator">=</span> <span class="token number">20</span></span>
<span class="line"><span class="token keyword">var</span> temperature celsius <span class="token operator">=</span> degrees</span>
<span class="line">temperature <span class="token operator">+=</span> <span class="token number">10</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token comment">// 30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>为什么声明新类型？极大地提高代码可读性和可靠性</p><p>不同的类型是无法混用的</p><p>声明函数类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> sensor <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> kelvin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="通过方法添加行为" tabindex="-1"><a class="header-anchor" href="#通过方法添加行为"><span>通过方法添加行为</span></a></h4><p>在 Go 里，它提供了方法，但是没提供类和对象</p><p>Go 比其他语言的方法要灵活</p><p>可以将方法与同包中声明的任何类型相关联，但不可以是 int、float32 等预声明的类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> celsius <span class="token builtin">float64</span></span>
<span class="line"><span class="token keyword">type</span> kelvin <span class="token builtin">float64</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">kelvinToCelsius</span><span class="token punctuation">(</span>k kelvin<span class="token punctuation">)</span> celsius <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">celsius</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">273.15</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>k kelvin<span class="token punctuation">)</span> <span class="token function">celsius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> celsius <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">celsius</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">273.15</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>celsius 方法虽然没有参数，但它前面却有一个类型参数的接收者</p><p>每个方法可以有多个参数，但只能有一个接收者</p><p>接收者的行为和其他参数是一样的</p></blockquote><h4 id="方法调用" tabindex="-1"><a class="header-anchor" href="#方法调用"><span>方法调用</span></a></h4><p>变量.方法名(参数)</p><h4 id="一等函数" tabindex="-1"><a class="header-anchor" href="#一等函数"><span>一等函数</span></a></h4><p>在 Go 里，函数是头等的，它可以用在整数、字符串或其他类型能用的地方：</p><ul><li>将函数赋给变量</li><li>将函数作为参数传递给函数</li><li>将函数作为函数的返回类型</li></ul><h4 id="闭包和匿名函数" tabindex="-1"><a class="header-anchor" href="#闭包和匿名函数"><span>闭包和匿名函数</span></a></h4><p>匿名函数就是没有名字的函数，在 Go 里也称作函数字面值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Dress up for the masquerade.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Dress up for the masquerade.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Dress up for the masquerade.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>因为函数字面值需要保留外部作用域的变量引用，所以函数字面值都是闭包的</p><p>闭包就是由于匿名函数封闭并包围作用域中的变量而得名</p><h3 id="数组" tabindex="-1"><a class="header-anchor" href="#数组"><span>数组</span></a></h3><p>数组是一种固定长度且有序的元素集合</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> colors <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line">colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Red&quot;</span></span>
<span class="line">colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Green&quot;</span></span>
<span class="line"></span>
<span class="line">color <span class="token operator">:=</span> colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token comment">// Green</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>数组的长度可以由内置函数 len 确定</p><p>在声明数组时，未被赋值元素的值是对应类型的零值</p></blockquote><h4 id="数组越界" tabindex="-1"><a class="header-anchor" href="#数组越界"><span>数组越界</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> colors <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line">colors<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Red&quot;</span></span>
<span class="line">i <span class="token operator">:=</span> <span class="token number">3</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// panic: runtime error: index out of range</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>Go 编译器在检测到对越界元素的访问时会报错</p><p>如果 Go 编译器在编译时未能发现越界错误，那么程序在运行时会出现 Panic</p><p>Panic 会导致程序崩溃</p></blockquote><h4 id="使用复合字面值初始化数组" tabindex="-1"><a class="header-anchor" href="#使用复合字面值初始化数组"><span>使用复合字面值初始化数组</span></a></h4><p>复合字面值（composite literal）是一种用于初始化复合类型（数组、切片、字典和结构体）的紧凑语法</p><p>只用一步就完成数组声明和数组初始化</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">colors <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Blue&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>可以在复合字面值里使用 ... 作为数组的长度，这样 Go 编译器会自动算出数组的元素数量</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">colors <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Blue&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>无论哪种方式，数组的长度都是固定的</p></blockquote><h4 id="遍历数组" tabindex="-1"><a class="header-anchor" href="#遍历数组"><span>遍历数组</span></a></h4><p>for 循环</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> dwarfs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>range 关键字</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> i<span class="token punctuation">,</span> dwarf <span class="token operator">:=</span> <span class="token keyword">range</span> dwarfs <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> dwarf<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="数组的复制" tabindex="-1"><a class="header-anchor" href="#数组的复制"><span>数组的复制</span></a></h4><p>无论数组赋值给新的变量还是将它传递给函数，都会产生一个完整的数组副本</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Mercury&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">planetsMarkII <span class="token operator">:=</span> planets</span>
<span class="line">planets<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;whoops&quot;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span> <span class="token comment">// [Mercury Venus whoops Mars Jupiter Saturn Uranus Neptune]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planetsMarkII<span class="token punctuation">)</span> <span class="token comment">// [Mercury Venus Earth Mars Jupiter Saturn Uranus Neptune]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets <span class="token operator">==</span> planetsMarkII<span class="token punctuation">)</span> <span class="token comment">// false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>数组也是一种值，函数通过值传递来接受参数，所以数组作为函数的参数就非常低效</p><p>数组的长度也是数组类型的一部分，将长度不符的数组作为参数传递会报错</p><p>函数一般使用 slice 而不是数组作为参数</p></blockquote><h4 id="数组的数组" tabindex="-1"><a class="header-anchor" href="#数组的数组"><span>数组的数组</span></a></h4><p>二维数组</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> board <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line"></span>
<span class="line">board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;r&quot;</span></span>
<span class="line">board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;r&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> column <span class="token operator">:=</span> <span class="token keyword">range</span> board<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  board<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;p&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="切片-slice" tabindex="-1"><a class="header-anchor" href="#切片-slice"><span>切片 Slice</span></a></h3><h4 id="slice-指向数组的窗口" tabindex="-1"><a class="header-anchor" href="#slice-指向数组的窗口"><span>Slice 指向数组的窗口</span></a></h4><p>假设 planets 是一个数组，那么 planets[0:4] 就是一个切片，它指向 planets 数组的前 4 个元素</p><p>切分数组不会导致数组被修改，它只是创建了指向数组的一个窗口或视图，这种视图就是 slice 类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Mercury&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// terrestrial := planets[0:4]</span></span>
<span class="line">terrestrial <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span></span>
<span class="line">gasGiants <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token comment">// iceGiants := planets[6:8]</span></span>
<span class="line">iceGiants <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">allPlanets <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>terrestrial<span class="token punctuation">)</span> <span class="token comment">// [Mercury Venus Earth Mars]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>gasGiants<span class="token punctuation">)</span> <span class="token comment">// [Jupiter Saturn]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>iceGiants<span class="token punctuation">)</span> <span class="token comment">// [Uranus Neptune]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>allPlanets<span class="token punctuation">)</span> <span class="token comment">// [Mercury Venus Earth Mars Jupiter Saturn Uranus Neptune]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>忽略掉 slice 的起始索引，表示从数组的起始位置进行切分</p><p>忽略掉 slice 的结束索引，相当于使用数组的长度作为结束索引</p><p>注意：slice 的索引不能是负数</p></blockquote><p>切分数组的语法也可以用于切分字符串</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">s <span class="token operator">:=</span> <span class="token string">&quot;hello, world&quot;</span></span>
<span class="line">c <span class="token operator">:=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span></span>
<span class="line">s <span class="token operator">=</span> <span class="token string">&quot;1111111&quot;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>切分字符串时，索引代表的时字节数而非 rune 数</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">question <span class="token operator">:=</span> <span class="token string">&quot;¿Cómo estás?&quot;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>question<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ¿Cómo</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="slice-的复合字面值" tabindex="-1"><a class="header-anchor" href="#slice-的复合字面值"><span>Slice 的复合字面值</span></a></h4><p>切分数组并不是创建 slice 的唯一方法，可以直接声明 slice</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">dwarfArray <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line">dwarfs <span class="token operator">:=</span> dwarfArray<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 直接声明 slice，不需要指定长度</span></span>
<span class="line">dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>切片应用</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">hyperspace</span><span class="token punctuation">(</span>worlds <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> worlds <span class="token punctuation">{</span></span>
<span class="line">    worlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>worlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot; Venus  &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; Mars&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">hyperspace</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>planets<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// VenusEarthMars</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="带有方法的切片" tabindex="-1"><a class="header-anchor" href="#带有方法的切片"><span>带有方法的切片</span></a></h4><p>在 Go 里，可以将 slice 或数组作为底层类型，然后绑定其它方法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">sort<span class="token punctuation">.</span><span class="token function">StringSlice</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span> <span class="token comment">// [Earth Jupiter Mars Neptune Saturn Uranus Venus]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="更大的-slice" tabindex="-1"><a class="header-anchor" href="#更大的-slice"><span>更大的 slice</span></a></h4><p>append 函数也是内置函数，它用于向 slice 里追加元素</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line">dwarfs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">,</span> <span class="token string">&quot;Orcus&quot;</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">)</span> <span class="token comment">// [Ceres Pluto Haumea Makemake Eris Orcus]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="长度和容量-length-capacity" tabindex="-1"><a class="header-anchor" href="#长度和容量-length-capacity"><span>长度和容量（length &amp; capacity）</span></a></h4><p>Slice 中元素的个数决定了 slice 的长度</p><p>如果 slice 的底层数组比 slice 还大，那么就说 slice 还有容量可供增长</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">dump</span><span class="token punctuation">(</span>label <span class="token builtin">string</span><span class="token punctuation">,</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: length %v, capacity %v %v\n&quot;</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  dwarfs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs&quot;</span><span class="token punctuation">,</span> dwarfs<span class="token punctuation">)</span> <span class="token comment">// dwarfs: length 5, capacity 5 [Ceres Pluto Haumea Makemake Eris]</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs[1:2]&quot;</span><span class="token punctuation">,</span> dwarfs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// dwarfs[1:2]: length 1, capacity 4 [Pluto]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>再结合 append 函数看一看</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">dump</span><span class="token punctuation">(</span>label <span class="token builtin">string</span><span class="token punctuation">,</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: length %v, capacity %v %v\n&quot;</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  dwarfs1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  dwarfs2 <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs1<span class="token punctuation">,</span> <span class="token string">&quot;Orcus&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  dwarfs3 <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs2<span class="token punctuation">,</span> <span class="token string">&quot;Salacia&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Quaoar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sedna&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs1&quot;</span><span class="token punctuation">,</span> dwarfs1<span class="token punctuation">)</span> <span class="token comment">// dwarfs1: length 5, capacity 5 [Ceres Pluto Haumea Makemake Eris]</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs2&quot;</span><span class="token punctuation">,</span> dwarfs2<span class="token punctuation">)</span> <span class="token comment">// dwarfs2: length 6, capacity 10 [Ceres Pluto Haumea Makemake Eris Orcus]</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs3&quot;</span><span class="token punctuation">,</span> dwarfs3<span class="token punctuation">)</span> <span class="token comment">// dwarfs3: length 9, capacity 10 [Ceres Pluto Haumea Makemake Eris Orcus Salacia Quaoar Sedna]</span></span>
<span class="line"></span>
<span class="line">  dwarfs3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Pluto!&quot;</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs1<span class="token punctuation">)</span> <span class="token comment">// [Ceres Pluto Haumea Makemake Eris]</span></span>
<span class="line">	<span class="token comment">/* 下面两个切片的底层数组是相同的 */</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs2<span class="token punctuation">)</span> <span class="token comment">// [Ceres Pluto! Haumea Makemake Eris Orcus]</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dwarfs3<span class="token punctuation">)</span> <span class="token comment">// [Ceres Pluto! Haumea Makemake Eris Orcus Salacia Quaoar Sedna]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="三个索引的切分操作" tabindex="-1"><a class="header-anchor" href="#三个索引的切分操作"><span>三个索引的切分操作</span></a></h4><p>Go 1.2 中引入了能够限制新建切片容量的三索引切分操作</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">dump</span><span class="token punctuation">(</span>label <span class="token builtin">string</span><span class="token punctuation">,</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: length %v, capacity %v %v\n&quot;</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Mercury&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  terrestrials <span class="token operator">:=</span> planets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// 又新分配了一个数组，长度为 4，容量为 4</span></span>
<span class="line">  worlds <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>terrestrials<span class="token punctuation">,</span> <span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 又新分配了一个数组，长度为 4，容量为 8</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;terrestrials&quot;</span><span class="token punctuation">,</span> terrestrials<span class="token punctuation">)</span> <span class="token comment">// terrestrials: length 4, capacity 4 [Mercury Venus Earth Mars]</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;worlds&quot;</span><span class="token punctuation">,</span> worlds<span class="token punctuation">)</span> <span class="token comment">// worlds: length 5, capacity 8 [Mercury Venus Earth Mars Ceres]</span></span>
<span class="line"></span>
<span class="line">  worlds2 <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>terrestrials<span class="token punctuation">,</span> <span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;worlds2&quot;</span><span class="token punctuation">,</span> worlds2<span class="token punctuation">)</span> <span class="token comment">// worlds2: length 9, capacity 12 [Mercury Venus Earth Mars Ceres Pluto Haumea Makemake Eris]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="使用-make-函数对-slice-进行预分配" tabindex="-1"><a class="header-anchor" href="#使用-make-函数对-slice-进行预分配"><span>使用 make 函数对 slice 进行预分配</span></a></h4><p>当 slice 的容量不足以执行 append 操作时，Go 必须创建新数组并复制旧数组中的内容</p><p>但通过内置的 make 函数，可以对 slice 进行预分配策略</p><ul><li>尽量避免额外的内存分配和数组重复操作</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">dump</span><span class="token punctuation">(</span>label <span class="token builtin">string</span><span class="token punctuation">,</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: length %v, capacity %v %v\n&quot;</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> slice<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  dwarfs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 预分配了一个长度为 0，容量为 10 的 slice。如果省略第三个参数，则第二个参数即规定长度也规定容量</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs&quot;</span><span class="token punctuation">,</span> dwarfs<span class="token punctuation">)</span> <span class="token comment">// dwarfs: length 0, capacity 10 []</span></span>
<span class="line"></span>
<span class="line">  dwarfs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dwarfs<span class="token punctuation">,</span> <span class="token string">&quot;Ceres&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Haumea&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Makemake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Eris&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">&quot;dwarfs&quot;</span><span class="token punctuation">,</span> dwarfs<span class="token punctuation">)</span> <span class="token comment">// dwarfs: length 5, capacity 10 [Ceres Pluto Haumea Makemake Eris]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="声明可变参数的函数" tabindex="-1"><a class="header-anchor" href="#声明可变参数的函数"><span>声明可变参数的函数</span></a></h4><p>声明 Printf、append 这样的可变参数函数，需要在函数的最后一个参数前面加上 ... 符号</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">terraform</span><span class="token punctuation">(</span>prefix <span class="token builtin">string</span><span class="token punctuation">,</span> worlds <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  newWorlds <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>worlds<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> worlds <span class="token punctuation">{</span></span>
<span class="line">    newWorlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> prefix <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> worlds<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> newWorlds</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  twoWorlds <span class="token operator">:=</span> <span class="token function">terraform</span><span class="token punctuation">(</span><span class="token string">&quot;New&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>twoWorlds<span class="token punctuation">)</span> <span class="token comment">// [New Venus New Mars]</span></span>
<span class="line"></span>
<span class="line">  planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  newPlanets <span class="token operator">:=</span> <span class="token function">terraform</span><span class="token punctuation">(</span><span class="token string">&quot;New&quot;</span><span class="token punctuation">,</span> planets<span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>newPlanets<span class="token punctuation">)</span> <span class="token comment">// [New Venus New Mars New Jupiter]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="map" tabindex="-1"><a class="header-anchor" href="#map"><span>map</span></a></h3><p>map 是 Go 提供的另外一种集合</p><ul><li>它可以将 key 映射到 value</li><li>它快速通过 key 找到对应的 value</li><li>它的 key 几乎可以是任何类型</li></ul><h4 id="声明-map" tabindex="-1"><a class="header-anchor" href="#声明-map"><span>声明 map</span></a></h4><p>声明 map 必须指定 key 和 value 的类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">temperature <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span></span>
<span class="line"><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;Mars&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">temp <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;On average the Earth is&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token string">&quot;Celsius.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">16</span></span>
<span class="line">temperature<span class="token punctuation">[</span><span class="token string">&quot;Venus&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">464</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token comment">// map[Earth:16 Mars:-65 Venus:464]</span></span>
<span class="line"></span>
<span class="line">moon <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Moon&quot;</span><span class="token punctuation">]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>moon<span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="与-ok-写法" tabindex="-1"><a class="header-anchor" href="#与-ok-写法"><span>, 与 ok 写法</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">temperature <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">temp<span class="token punctuation">,</span> ok <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> ok<span class="token punctuation">)</span> <span class="token comment">// 15 true</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> moon<span class="token punctuation">,</span> ok <span class="token operator">:=</span> temperature<span class="token punctuation">[</span><span class="token string">&quot;Moon&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>moon<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Where is the Moon?&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Where is the Moon?</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="map-不会复制" tabindex="-1"><a class="header-anchor" href="#map-不会复制"><span>map 不会复制</span></a></h4><p>数组、int、float64 等类型在赋值给新变量或传递至函数/方法时会创建相应的副本</p><p>但 map 不会</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">planets <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Sector ZZ9&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Sector ZZ9&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">planetsMarkII <span class="token operator">:=</span> planets</span>
<span class="line">planets<span class="token punctuation">[</span><span class="token string">&quot;Earth&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;whoops&quot;</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span> <span class="token comment">// map[Earth:whoops Mars:Sector ZZ9]</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planetsMarkII<span class="token punctuation">)</span> <span class="token comment">// map[Earth:whoops Mars:Sector ZZ9]</span></span>
<span class="line"></span>
<span class="line"><span class="token function">delete</span><span class="token punctuation">(</span>planets<span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planetsMarkII<span class="token punctuation">)</span> <span class="token comment">// map[Mars:Sector ZZ9]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="使用-make-函数对-map-进行预分配" tabindex="-1"><a class="header-anchor" href="#使用-make-函数对-map-进行预分配"><span>使用 make 函数对 map 进行预分配</span></a></h4><p>除非使用复合字面值来初始化 map，否则必须使用内置的 make 函数来为 map 分配空间</p><p>创建 map 时，make 函数可以接收一个或两个参数</p><ul><li>第一个参数是 map 的类型</li><li>第二个参数是可选的，用于指定 map 的初始容量（为指定数量的 key 预先分配空间）</li></ul><p>使用 make 函数创建的 map 初始长度是 0</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">temperature <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="使用-map-作计数器" tabindex="-1"><a class="header-anchor" href="#使用-map-作计数器"><span>使用 map 作计数器</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">temperature <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">frequency <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperature <span class="token punctuation">{</span></span>
<span class="line">  frequency<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* range 遍历 map 时是无法保证顺序的 */</span></span>
<span class="line"><span class="token keyword">for</span> t<span class="token punctuation">,</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> frequency <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+.2f occurs %d times\n&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> num<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="使用-map-和-slice-实现数据分组" tabindex="-1"><a class="header-anchor" href="#使用-map-和-slice-实现数据分组"><span>使用 map 和 slice 实现数据分组</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">temperature <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">groups <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperature <span class="token punctuation">{</span></span>
<span class="line">  g <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Trunc</span><span class="token punctuation">(</span>t<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span></span>
<span class="line">  groups<span class="token punctuation">[</span>g<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>groups<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> g<span class="token punctuation">,</span> temperatures <span class="token operator">:=</span> <span class="token keyword">range</span> groups <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v: %v\n&quot;</span><span class="token punctuation">,</span> g<span class="token punctuation">,</span> temperatures<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="将-map-用作-set" tabindex="-1"><a class="header-anchor" href="#将-map-用作-set"><span>将 map 用作 set</span></a></h4><p>Set 这种集合与数组类似，但元素不会重复</p><p>Go 语言里没有提供 set 集合</p><p>但可以使用 map 来实现 set 集合</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> temperatures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">29.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">33.0</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 去重 */</span></span>
<span class="line"></span>
<span class="line">set <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">float64</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> temperatures <span class="token punctuation">{</span></span>
<span class="line">  set<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> set<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">28.0</span><span class="token punctuation">]</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;set member&quot;</span><span class="token punctuation">)</span> <span class="token comment">// set member</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 排序 */</span></span>
<span class="line"></span>
<span class="line">unique <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> set <span class="token punctuation">{</span></span>
<span class="line">  unique <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>unique<span class="token punctuation">,</span> t<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">sort<span class="token punctuation">.</span><span class="token function">Float64s</span><span class="token punctuation">(</span>unique<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>unique<span class="token punctuation">)</span> <span class="token comment">// [-33 -31 -29 -28 -23 32]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="结构-struct" tabindex="-1"><a class="header-anchor" href="#结构-struct"><span>结构 struct</span></a></h3><p>为了将分散的零件组成一个完整的结构体，Go 提供了 struct 类型</p><h4 id="声明结构" tabindex="-1"><a class="header-anchor" href="#声明结构"><span>声明结构</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> curiosity <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat <span class="token builtin">float64</span></span>
<span class="line">  long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">curiosity<span class="token punctuation">.</span>lat <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4.5895</span></span>
<span class="line">curiosity<span class="token punctuation">.</span>long <span class="token operator">=</span> <span class="token number">137.4417</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> curiosity<span class="token punctuation">.</span>long<span class="token punctuation">)</span> <span class="token comment">// -4.5895 137.4417</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span> <span class="token comment">// { -4.5895 137.4417}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="通过类型复用结构体" tabindex="-1"><a class="header-anchor" href="#通过类型复用结构体"><span>通过类型复用结构体</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat <span class="token builtin">float64</span></span>
<span class="line">  long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> spirit location</span>
<span class="line">spirit<span class="token punctuation">.</span>lat <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">14.5684</span></span>
<span class="line">spirit<span class="token punctuation">.</span>long <span class="token operator">=</span> <span class="token number">175.472636</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 通过成对的字段和值进行初始化 */</span></span>
<span class="line">opportunity <span class="token operator">:=</span> location<span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">354.4734</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 按照字段声明的顺序初始化 */</span></span>
<span class="line">insight <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">135.9</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> insight<span class="token punctuation">)</span> <span class="token comment">// {-4.5 135.9}</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> insight<span class="token punctuation">)</span> <span class="token comment">// {lat:-4.5 long:135.9}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>spirit<span class="token punctuation">,</span> opportunity<span class="token punctuation">)</span> <span class="token comment">// {-14.5684 175.472636} {-1.9462 354.4734}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="struct-的复制" tabindex="-1"><a class="header-anchor" href="#struct-的复制"><span>struct 的复制</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">bradbury <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span></span>
<span class="line">curiosity <span class="token operator">:=</span> bradbury <span class="token comment">// 两个不同的实例</span></span>
<span class="line"></span>
<span class="line">curiosity<span class="token punctuation">.</span>long <span class="token operator">+=</span> <span class="token number">0.0106</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bradbury<span class="token punctuation">,</span> curiosity<span class="token punctuation">)</span> <span class="token comment">// {-4.5895 137.4417} {-4.5895 137.4523}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="由结构体组成的-slice" tabindex="-1"><a class="header-anchor" href="#由结构体组成的-slice"><span>由结构体组成的 slice</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line">  name <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">lats <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">14.5684</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">}</span></span>
<span class="line">longs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token number">137.4417</span><span class="token punctuation">,</span> <span class="token number">175.472636</span><span class="token punctuation">,</span> <span class="token number">354.4734</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">locations <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>location<span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">137.4417</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Bradbury Landing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">14.5684</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">175.472636</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Columbia Memorial Station&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span>lat<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">,</span> long<span class="token punctuation">:</span> <span class="token number">354.4734</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Challenger Memorial Station&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>locations<span class="token punctuation">)</span> <span class="token comment">// [{-4.5895 137.4417 Bradbury Landing} {-14.5684 175.472636 Columbia Memorial Station} {-1.9462 354.4734 Challenger Memorial Station}]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="将-struct-编码为-json" tabindex="-1"><a class="header-anchor" href="#将-struct-编码为-json"><span>将 struct 编码为 JSON</span></a></h4><p>JSON (JavaScript Object Notation，JavaScript 对象表示法)</p><p>常用于 Web API</p><p>json 包中的 Marshal 函数可以将 struct 编码为 JSON</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  Lat<span class="token punctuation">,</span> Long <span class="token builtin">float64</span></span>
<span class="line">  <span class="token comment">// lat, long float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  curiosity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">exitOnError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {&quot;lat&quot;:-4.5895,&quot;long&quot;:137.4417}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">exitOnError</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>Marshal 函数只会编码 struct 中被导出的字段（首字母大写）</p></blockquote><h4 id="使用-struct-标签来定义-json" tabindex="-1"><a class="header-anchor" href="#使用-struct-标签来定义-json"><span>使用 struct 标签来定义 JSON</span></a></h4><p>Go 语言中 json 包要求 struct 中的字段必须以大写字母开头（类似 CamelCase 大驼峰），但如果需要 snake_case 蛇形命名规范，可以为字段注明标签，使得 json 包在进行编码的时候能够按照标签里的样式修改字段名</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"></span>
<span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  Lat <span class="token builtin">float64</span> <span class="token string">`json:&quot;latitude&quot;xml:&quot;latitude&quot;`</span></span>
<span class="line">  Long <span class="token builtin">float64</span> <span class="token string">`json:&quot;longitude&quot;`</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  curiosity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">exitOnError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {&quot;latitude&quot;:-4.5895,&quot;longitude&quot;:137.4417}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">exitOnError</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="go-语言里没有-class" tabindex="-1"><a class="header-anchor" href="#go-语言里没有-class"><span>Go 语言里没有 class</span></a></h4><p>Go 和其他经典语言不同，它没有 class，没有对象，也没有继承</p><p>但是 Go 提供了 struct 和方法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> coordinate <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  d<span class="token punctuation">,</span> m<span class="token punctuation">,</span> s <span class="token builtin">float64</span></span>
<span class="line">  h <span class="token builtin">rune</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c coordinate<span class="token punctuation">)</span> <span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span></span>
<span class="line">  sign <span class="token operator">:=</span> <span class="token number">1.0</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">switch</span> c<span class="token punctuation">.</span>h <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token char">&#39;S&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;W&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;s&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;w&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    sign <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> sign <span class="token operator">*</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>d <span class="token operator">+</span> c<span class="token punctuation">.</span>m <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>s <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  lat <span class="token operator">:=</span> coordinate<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">22.2</span><span class="token punctuation">,</span> <span class="token char">&#39;S&#39;</span><span class="token punctuation">}</span></span>
<span class="line">  long <span class="token operator">:=</span> coordinate<span class="token punctuation">{</span><span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">30.12</span><span class="token punctuation">,</span> <span class="token char">&#39;E&#39;</span><span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>lat<span class="token punctuation">.</span><span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> long<span class="token punctuation">.</span><span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -4.5895 137.4417</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="构造函数" tabindex="-1"><a class="header-anchor" href="#构造函数"><span>构造函数</span></a></h4><p>可以使用 struct 复合字面值来初始化想要的数据；但如果 struct 初始化的时候还有做很多事情，那就可以考虑写一个构造用的函数：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> coordinate <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  d<span class="token punctuation">,</span> m<span class="token punctuation">,</span> s <span class="token builtin">float64</span></span>
<span class="line">  h <span class="token builtin">rune</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c coordinate<span class="token punctuation">)</span> <span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span></span>
<span class="line">  sign <span class="token operator">:=</span> <span class="token number">1.0</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">switch</span> c<span class="token punctuation">.</span>h <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> <span class="token char">&#39;S&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;W&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;s&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;w&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    sign <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> sign <span class="token operator">*</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>d <span class="token operator">+</span> c<span class="token punctuation">.</span>m <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>s <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* new/New 开头，后面跟一个类型的名称，通常就代表这个类型的构造函数（约定） */</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">newLocation</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span> long coordinate<span class="token punctuation">)</span> location <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> location<span class="token punctuation">{</span>lat<span class="token punctuation">.</span><span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> long<span class="token punctuation">.</span><span class="token function">decimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>Go 语言没有专门的构造函数，但以 new 或者 New 开头的函数，通常是用来构造数据的</p><p>有一些构造函数的名称就是 New（例如 errors 包里面的 New 函数），errors.New()</p><h4 id="class-的替代方案" tabindex="-1"><a class="header-anchor" href="#class-的替代方案"><span>class 的替代方案</span></a></h4><p>Go 语言中没有 class，但是可以使用 struct 和方法来实现类似的功能</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> world <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  radius <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">rad</span><span class="token punctuation">(</span>deg <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> deg <span class="token operator">*</span> math<span class="token punctuation">.</span>Pi <span class="token operator">/</span> <span class="token number">180</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>w world<span class="token punctuation">)</span> <span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2 location<span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span></span>
<span class="line">  s1<span class="token punctuation">,</span> c1 <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sincos</span><span class="token punctuation">(</span><span class="token function">rad</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  s2<span class="token punctuation">,</span> c2 <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sincos</span><span class="token punctuation">(</span><span class="token function">rad</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  clong <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span><span class="token function">rad</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>long <span class="token operator">-</span> p2<span class="token punctuation">.</span>long<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> w<span class="token punctuation">.</span>radius <span class="token operator">*</span> math<span class="token punctuation">.</span><span class="token function">Acos</span><span class="token punctuation">(</span>s1 <span class="token operator">*</span> s2 <span class="token operator">+</span> c1 <span class="token operator">*</span> c2 <span class="token operator">*</span> clong<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mars <span class="token operator">:=</span> world<span class="token punctuation">{</span>radius<span class="token punctuation">:</span> <span class="token number">3389.5</span><span class="token punctuation">}</span></span>
<span class="line">  spirit <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">14.5684</span><span class="token punctuation">,</span> <span class="token number">175.472636</span><span class="token punctuation">}</span></span>
<span class="line">  opportunity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1.9462</span><span class="token punctuation">,</span> <span class="token number">354.4734</span><span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%.2f km\n&quot;</span><span class="token punctuation">,</span> mars<span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>spirit<span class="token punctuation">,</span> opportunity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 9669.71 km</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="组合与转发-composition-forwarding" tabindex="-1"><a class="header-anchor" href="#组合与转发-composition-forwarding"><span>组合与转发（composition &amp; forwarding）</span></a></h4><p>Go 通过结构体实现组合</p><p>Go 提供了“嵌入”（embedding）特性，它可以实现方法的转发（forwarding）</p><p>组合相对于继承更简单、灵活</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// type report struct {</span></span>
<span class="line"><span class="token comment">// 	sol         int</span></span>
<span class="line"><span class="token comment">// 	temperature temperature</span></span>
<span class="line"><span class="token comment">// 	location    location</span></span>
<span class="line"><span class="token comment">// }</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> sol <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> report <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	sol</span>
<span class="line">	temperature</span>
<span class="line">	location</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> temperature <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	high<span class="token punctuation">,</span> low celsius</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> celsius <span class="token builtin">float64</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>t temperature<span class="token punctuation">)</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span> celsius <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>high <span class="token operator">+</span> t<span class="token punctuation">.</span>low<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s sol<span class="token punctuation">)</span> <span class="token function">days</span><span class="token punctuation">(</span>s2 sol<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">	days <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>s2 <span class="token operator">-</span> s<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> days <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token operator">-</span>days</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> days</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// func (r report) average() celsius {</span></span>
<span class="line"><span class="token comment">// 	return r.temperature.average()</span></span>
<span class="line"><span class="token comment">// }</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t <span class="token operator">:=</span> temperature<span class="token punctuation">{</span>high<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> low<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">78.0</span><span class="token punctuation">}</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -39.5</span></span>
<span class="line">	loc <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span></span>
<span class="line">	rep <span class="token operator">:=</span> report<span class="token punctuation">{</span>sol<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> temperature<span class="token punctuation">:</span> t<span class="token punctuation">,</span> location<span class="token punctuation">:</span> loc<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -39.5</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token comment">// -39.5</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>high<span class="token punctuation">)</span>                  <span class="token comment">// -1</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>sol<span class="token punctuation">.</span><span class="token function">days</span><span class="token punctuation">(</span><span class="token number">1446</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1431</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">days</span><span class="token punctuation">(</span><span class="token number">1446</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// 1431</span></span>
<span class="line"></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> rep<span class="token punctuation">)</span> <span class="token comment">// {sol:15 temperature:{high:-1 low:-78} location:{lat:-4.5895 long:137.4417}}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>Go 可以通过 struct 嵌入来实现方法的转发</p><p>在 struct 中只给定字段类型，不给定字段名即可</p><p>在 struct 中可以转发任意类型</p></blockquote><p>Go 语言中，如果两个字段名字相同，那么在访问的时候就必须使用完整的路径</p><h4 id="接口" tabindex="-1"><a class="header-anchor" href="#接口"><span>接口</span></a></h4><p>类型关注于可以做什么，而不是存储了什么</p><p>接口通过列举类型必须满足的一组方法来进行声明</p><p>在 Go 语言中，不需要显示声明接口</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> t <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> martian <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m martian<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token string">&quot;nack nack&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> laser <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l laser<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Repeat</span><span class="token punctuation">(</span><span class="token string">&quot;pew &quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  t <span class="token operator">=</span> martian<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// nack nack</span></span>
<span class="line"></span>
<span class="line">  t <span class="token operator">=</span> <span class="token function">laser</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// pew pew pew</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>为了复用，通常会把接口声明为类型</p><p>按约定，接口名称通常以 er 结尾</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> talker <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> martian <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m martian<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token string">&quot;nack nack&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> laser <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l laser<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Repeat</span><span class="token punctuation">(</span><span class="token string">&quot;pew &quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">shout</span><span class="token punctuation">(</span>t talker<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  louder <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>louder<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 接口配合 struct 嵌入特性一起使用 */</span></span>
<span class="line"><span class="token keyword">type</span> starship <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  laser</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">   s <span class="token operator">:=</span> starship<span class="token punctuation">{</span><span class="token function">laser</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span>martian<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// NACK NACK</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span><span class="token function">laser</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// PEW PEW</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// PEW PEW PEW</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>同时使用组合和接口将构成非常强大的设计工具</p></blockquote><h4 id="满足接口" tabindex="-1"><a class="header-anchor" href="#满足接口"><span>满足接口</span></a></h4><p>Go 语言的接口都是隐式满足的</p><p>Go 标准库导出了很多只有单个方法的接口</p><p>例如 fmt 包声明的 Stringer 接口</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> Stringer <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> location <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  lat<span class="token punctuation">,</span> long <span class="token builtin">float64</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l location<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%v, %v&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span>lat<span class="token punctuation">,</span> l<span class="token punctuation">.</span>long<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  curiosity <span class="token operator">:=</span> location<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">4.5895</span><span class="token punctuation">,</span> <span class="token number">137.4417</span><span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>curiosity<span class="token punctuation">)</span> <span class="token comment">// -4.5895, 137.4417</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>标准库中常用的接口还包括：io.Reader、io.Writer、http.Handler、json.Marshaler 等</p><h3 id="指针" tabindex="-1"><a class="header-anchor" href="#指针"><span>指针</span></a></h3><p>指针是指向另一个变量地址的变量</p><p>Go 语言的指针同时强调安全性，不会出现迷途指针（dangling pointers）</p><p>变量会将它们的值存储在计算机 RAM 里，存储位置就是该变量的内存地址</p><p>&amp; 表示地址操作符，通过 &amp; 可以获得变量的内存地址</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  answer <span class="token operator">:=</span> <span class="token number">42</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>answer<span class="token punctuation">)</span> <span class="token comment">// 0xc0000140a8 类似的一个地址</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>&amp; 操作符无法获得字符串/数值/布尔字面值的地址，&amp;42，&amp;&quot;hello&quot; 都会导致编译器报错</p></blockquote><p>* 操作符与 &amp; 的作用相反，它用来解引用，提供内存地址指向的值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">answer <span class="token operator">:=</span> <span class="token number">42</span></span>
<span class="line"><span class="token comment">/* Go 语言不允许 address++ 这样的指针运算进行操作 */</span></span>
<span class="line">address <span class="token operator">:=</span> <span class="token operator">&amp;</span>answer</span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>address<span class="token punctuation">)</span> <span class="token comment">// 42</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span> <span class="token comment">// *int</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>指针存储的是内存地址</p><p><strong>指针类型</strong>和其他普通类型一样，出现在所有需要用到类型的地方，如变量声明、函数形参、返回值类型、结构体字段等</p></blockquote><p>指针类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">canada <span class="token operator">:=</span> <span class="token string">&quot;Canada&quot;</span></span>
<span class="line"><span class="token keyword">var</span> home <span class="token operator">*</span><span class="token builtin">string</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;home is a %T\n&quot;</span><span class="token punctuation">,</span> home<span class="token punctuation">)</span> <span class="token comment">// home is a *string</span></span>
<span class="line">home <span class="token operator">=</span> <span class="token operator">&amp;</span>canada</span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>home<span class="token punctuation">)</span> <span class="token comment">// Canada</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>将 * 放在类型前面，表示声明一个指针类型</p><p>将 * 放在变量前面，表示解引用操作，获取指针指向的值</p></blockquote><p>两个指针变量指向同一个内存地址，那么它们就是相等的</p><h4 id="指向结构的指针" tabindex="-1"><a class="header-anchor" href="#指向结构的指针"><span>指向结构的指针</span></a></h4><p>与字符串和数值不一样，复合字面量的前面可以放置 &amp;</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  name<span class="token punctuation">,</span> superpower <span class="token builtin">string</span></span>
<span class="line">  age <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">timmy <span class="token operator">:=</span> <span class="token operator">&amp;</span>person<span class="token punctuation">{</span></span>
<span class="line">  name<span class="token punctuation">:</span> <span class="token string">&quot;Timothy&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">timmy<span class="token punctuation">.</span>superpower <span class="token operator">=</span> <span class="token string">&quot;flying&quot;</span> <span class="token comment">// 等价于 (*timmy).superpower = &quot;flying&quot;</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> timmy<span class="token punctuation">)</span> <span class="token comment">// &amp;{name:Timothy superpower:flying age:10}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>访问字段时，对结构体进行解引用并不是必须的</p></blockquote><h4 id="指向数组的指针" tabindex="-1"><a class="header-anchor" href="#指向数组的指针"><span>指向数组的指针</span></a></h4><p>和结构体一样，可以把 &amp; 放在数组的复合字面值前面来创建指向数组的指针</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">superpowers <span class="token operator">:=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;flight&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;invisibility&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;super strength&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>superpowers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// flight</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>superpowers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [invisibility]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>数组在执行索引或切片操作时，会自动解引用，没有必要写 (*superpowers)[0] 这种形式</p><p>Go 里面数组和指针是两种完全独立的类型</p><p>slice 和 map 的复合字面值前面也可以放置 &amp; 操作符，但是 Go 并没有为它们提供自动解引用的功能</p></blockquote><h4 id="实现修改" tabindex="-1"><a class="header-anchor" href="#实现修改"><span>实现修改</span></a></h4><p>Go 语言的函数和方法都是按值传递参数的，这意味着函数总是操作于被传递参数的副本</p><p>当指针被传递到函数时，函数将接受传入的内存地址的副本。之后函数可以通过解引用内存地址来修改指针指向的值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  name <span class="token builtin">string</span></span>
<span class="line">  age <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">birthday</span><span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  p<span class="token punctuation">.</span>age<span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  timmy <span class="token operator">:=</span> <span class="token operator">&amp;</span>person<span class="token punctuation">{</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token string">&quot;Timothy&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">birthday</span><span class="token punctuation">(</span>timmy<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> timmy<span class="token punctuation">)</span> <span class="token comment">// &amp;{name:Timothy superpower: age:11}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="指针接收者" tabindex="-1"><a class="header-anchor" href="#指针接收者"><span>指针接收者</span></a></h4><p>方法的接收者和方法的参数在处理指针方面是很相似的</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  name <span class="token builtin">string</span></span>
<span class="line">  age <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  p<span class="token punctuation">.</span>age<span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  timmy <span class="token operator">:=</span> <span class="token operator">&amp;</span>person<span class="token punctuation">{</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token string">&quot;Timothy&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  timmy<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> timmy<span class="token punctuation">)</span> <span class="token comment">// &amp;{name:Timothy superpower: age:11}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">/* Go 语言在变量通过点标记法进行调用的时候，自动使用 &amp; 取得变量的内存地址 */</span></span>
<span class="line">  nathan <span class="token operator">:=</span> person<span class="token punctuation">{</span><span class="token string">&quot;Nathan&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">}</span></span>
<span class="line">  nathan<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// (&amp;nathan).birthday()</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> nathan<span class="token punctuation">)</span> <span class="token comment">// {name:Nathan superpower: age:19}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>使用指针作为接收者的策略应该始终如一：如果一种类型的某些方法需要用到指针作为接收者，这种类型的所有方法就应该都是用指针作为接收者</p></blockquote><h4 id="内部指针" tabindex="-1"><a class="header-anchor" href="#内部指针"><span>内部指针</span></a></h4><p>Go 提供了内部指针这种特性，它用于确定结构体中指定字段的内存地址</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> stats <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  level <span class="token builtin">int</span></span>
<span class="line">  endurance<span class="token punctuation">,</span> health <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">levelUp</span><span class="token punctuation">(</span>s <span class="token operator">*</span>stats<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  s<span class="token punctuation">.</span>level<span class="token operator">++</span></span>
<span class="line">  s<span class="token punctuation">.</span>endurance <span class="token operator">=</span> <span class="token number">42</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">14</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>level<span class="token punctuation">)</span></span>
<span class="line">  s<span class="token punctuation">.</span>health <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>endurance</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> character <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  name <span class="token builtin">string</span></span>
<span class="line">  stats stats</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  player <span class="token operator">:=</span> character<span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Matthias&quot;</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">levelUp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>player<span class="token punctuation">.</span>stats<span class="token punctuation">)</span> <span class="token comment">// &amp; 操作符不仅可以获得结构体的内存地址，还可以获得结构体中指定字段的内存地址</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%+v\n&quot;</span><span class="token punctuation">,</span> player<span class="token punctuation">)</span> <span class="token comment">// {name:Matthias stats:{level:1 endurance:56 health:280}}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="修改数组" tabindex="-1"><a class="header-anchor" href="#修改数组"><span>修改数组</span></a></h4><p>函数通过指针对数组的元素进行修改</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">reset</span><span class="token punctuation">(</span>board <span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">&#39;r&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> board <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token builtin">rune</span></span>
<span class="line">  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>board<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%c&quot;</span><span class="token punctuation">,</span> board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// r</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="隐式的指针" tabindex="-1"><a class="header-anchor" href="#隐式的指针"><span>隐式的指针</span></a></h4><p>Go 语言里的一些内置的集合类型就在暗中使用指针</p><ul><li><p>map 在被赋值或者作为参数传递的时候不会被复制</p><ul><li><code>func demolish(planets *map[string]string)</code> 这种写法就是多此一举</li><li>map 的键和值都可以是指针类型</li><li>需要将指针指向 map 的情况不多见</li></ul></li><li><p>slice 在指向数组元素的时候也使用了指针</p><ul><li>每个 slice 内部都会被表示为一个包含 3 个元素的结构，它们分别指向数组的指针、slice 的长度和 slice 的容量</li><li>当 slice 被直接传递至函数或方法时，slice 的内部指针就可以对底层数据进行修改</li><li>指向 slice 的显示指针的唯一作用就是修改 slice 本身，slice 的长度、容量以及起始偏移量</li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">reclassify</span><span class="token punctuation">(</span>planets <span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">*</span>planets <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>planets<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  planets <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;Mercury&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Venus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Mars&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;Jupiter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Saturn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Uranus&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Neptune&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pluto&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">reclassify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>planets<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>planets<span class="token punctuation">)</span> <span class="token comment">// [Mercury Venus Earth Mars Jupiter Saturn Uranus Neptune]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="指针和接口" tabindex="-1"><a class="header-anchor" href="#指针和接口"><span>指针和接口</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> talker <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">shout</span><span class="token punctuation">(</span>t talker<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> martian <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m martian<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token string">&quot;nack nack&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">/* 无论是 martian 还是指向 martian 的指针，都可以满足 talker 接口 */</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span>martian<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// NACK NACK</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>martian<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// NACK NACK</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>上例中无论是 martian 还是指向 martian 的指针，都可以满足 talker 接口</p><p>如果方法使用的是指针接收者，那么情况会有所不同</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> talker <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">shout</span><span class="token punctuation">(</span>t talker<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> laser <span class="token builtin">int</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>laser<span class="token punctuation">)</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Repeat</span><span class="token punctuation">(</span><span class="token string">&quot;pew &quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token operator">*</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  laser <span class="token operator">:=</span> <span class="token function">laser</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>laser<span class="token punctuation">)</span> <span class="token comment">// PEW PEW</span></span>
<span class="line">  <span class="token function">shout</span><span class="token punctuation">(</span>laser<span class="token punctuation">)</span> <span class="token comment">// cannot use laser (type laser) as type talker in argument to shout: laser does not implement talker (talk method has pointer receiver)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="明智的使用指针" tabindex="-1"><a class="header-anchor" href="#明智的使用指针"><span>明智的使用指针</span></a></h4><p>应合理使用指针，不要过度使用</p><h3 id="nil" tabindex="-1"><a class="header-anchor" href="#nil"><span>nil</span></a></h3><p>nil 是一个名词，表示“无”或者“零”</p><p>在 Go 里，nil 是一个零值</p><p>如果一个指针没有明确的指向，那么它的值就是 nil</p><p>除了指针，nil 还是 slice 、map、channel、interface 和函数的零值</p><p>Go 语言的 nil 比以往语言的 null 更为友好，并且用的没那么频繁，但是仍需谨慎使用</p><h4 id="nil-会导致-panic" tabindex="-1"><a class="header-anchor" href="#nil-会导致-panic"><span>nil 会导致 panic</span></a></h4><p>如果指针没有明确的指向，那么程序将无法对其实施解引用</p><p>尝试解引用一个 nil 指针将导致程序崩溃</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> nowhere <span class="token operator">*</span><span class="token builtin">int</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>nowhere<span class="token punctuation">)</span> <span class="token comment">// &lt;nil&gt;</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>nowhere<span class="token punctuation">)</span> <span class="token comment">// panic: runtime error: invalid memory address or nil pointer dereference</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="避免-nil-引发-panic" tabindex="-1"><a class="header-anchor" href="#避免-nil-引发-panic"><span>避免 nil 引发 panic</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  age <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>person<span class="token punctuation">)</span> <span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 避免 nil 引发 panic</span></span>
<span class="line">  <span class="token keyword">if</span> p <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  p<span class="token punctuation">.</span>age<span class="token operator">++</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> nobody <span class="token operator">*</span>person</span>
<span class="line">  nobody<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>因为值为 nil 的接收者和值为 nil 的参数在行为上并没有区别，所以 Go 语言即使在接收者为 nil 的情况下，也会继续调用方法</p></blockquote><h4 id="nil-函数值" tabindex="-1"><a class="header-anchor" href="#nil-函数值"><span>nil 函数值</span></a></h4><p>当变量被声明为函数类型时，它的默认值是 nil</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>fn <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>检查函数值是否为 nil，并在有需要时提供默认行为</p><h4 id="nil-slice" tabindex="-1"><a class="header-anchor" href="#nil-slice"><span>nil slice</span></a></h4><p>如果 slice 在声明之后没有使用复合字面值或内置的 make 函数进行初始化，那么它的值就是 nil</p><p>幸运的是，range\len\append 等内置函数都可以安全地处理值为 nil 的 slice</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> soup <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>soup <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ingredient <span class="token operator">:=</span> <span class="token keyword">range</span> soup <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ingredient<span class="token punctuation">)</span> <span class="token comment">// 不会执行</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>soup<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span></span>
<span class="line"></span>
<span class="line">soup <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>soup<span class="token punctuation">,</span> <span class="token string">&quot;onion&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;carrot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;celery&quot;</span><span class="token punctuation">)</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>soup<span class="token punctuation">)</span> <span class="token comment">// [onion carrot celery]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>虽然空 slice 和值为 nil 的 slice 并不相等，但它们通常可以替换使用</p><h4 id="nil-map" tabindex="-1"><a class="header-anchor" href="#nil-map"><span>nil map</span></a></h4><p>和 slice 一样，如果 map 在声明之后没有使用复合字面值或内置的 make 函数进行初始化，那么它的值就是 nil</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> soup <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>soup <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true</span></span>
<span class="line"></span>
<span class="line">measurements<span class="token punctuation">,</span> ok <span class="token operator">:=</span> soup<span class="token punctuation">[</span><span class="token string">&quot;onion&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">if</span> ok <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span> <span class="token comment">// 不会执行</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ingredient<span class="token punctuation">,</span> measurement <span class="token operator">:=</span> <span class="token keyword">range</span> soup <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>ingredient<span class="token punctuation">,</span> measurement<span class="token punctuation">)</span> <span class="token comment">// 不会执行</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="nil-接口" tabindex="-1"><a class="header-anchor" href="#nil-接口"><span>nil 接口</span></a></h4><p>声明为接口类型的变量在未被赋值时，它的零值是 nil</p><p>对于一个未被赋值的接口变量来说，它的接口类型和值都是 nil，并且变量本身也等于 nil</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %v %v\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// &lt;nil&gt; &lt;nil&gt; true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>当接口类型的变量被赋值后，接口就会在内部指向该变量的类型和值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %v %v\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// &lt;nil&gt; &lt;nil&gt; true</span></span>
<span class="line"><span class="token keyword">var</span> p <span class="token operator">*</span><span class="token builtin">int</span></span>
<span class="line">v <span class="token operator">=</span> p</span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T %v %v\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// *int &lt;nil&gt; false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检验接口变量的内部表示</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token comment">// (*int)(nil)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>在 Go 中，接口类型的变量只有在类型和值都为 nil 时才等于 nil</p></blockquote><h4 id="nil-之外的另一个选择" tabindex="-1"><a class="header-anchor" href="#nil-之外的另一个选择"><span>nil 之外的另一个选择</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> number <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  value <span class="token builtin">int</span></span>
<span class="line">  valid <span class="token builtin">bool</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">newNumber</span><span class="token punctuation">(</span>v <span class="token builtin">int</span><span class="token punctuation">)</span> number <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> number<span class="token punctuation">{</span>value<span class="token punctuation">:</span> v<span class="token punctuation">,</span> valid<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>n number<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token operator">!</span>n<span class="token punctuation">.</span>valid <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;未知&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  n <span class="token operator">:=</span> <span class="token function">newNumber</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 42</span></span>
<span class="line">  n <span class="token operator">=</span> number<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// 未知</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="错误" tabindex="-1"><a class="header-anchor" href="#错误"><span>错误</span></a></h3><h4 id="处理错误" tabindex="-1"><a class="header-anchor" href="#处理错误"><span>处理错误</span></a></h4><p>Go 语言允许函数和方法同时返回多个值</p><p>按照惯例，函数在返回错误时，最后边的返回值应用来表示错误</p><p>调用函数后，应立即检查是否发生错误</p><ul><li>如果没有错误发生，那么返回的错误值为 nil</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">files<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">  os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> file <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>注意：当错误发生时，函数返回的其他值通常就不再可信</p><h4 id="优雅的错误处理" tabindex="-1"><a class="header-anchor" href="#优雅的错误处理"><span>优雅的错误处理</span></a></h4><p>减少错误处理代码的一种策略是：将程序中不会出错的部分和包含潜在错误隐患的部分隔离开来</p><p>对于不得不返回错误的代码，应尽力简化相应的错误处理代码</p><h4 id="文件写入" tabindex="-1"><a class="header-anchor" href="#文件写入"><span>文件写入</span></a></h4><p>写入文件的时候可能出错：</p><ul><li>路径不正确</li><li>权限不够</li><li>磁盘空间不足</li><li>...</li></ul><p>文件写入完毕后，必须被关闭，确保文件被刷到磁盘上，避免资源的泄露</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// 内置类型 error 用来表示错误</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">proverbs</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> err</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Errors are values.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> err</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Don&#39;t just check errors, handle them gracefully.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> err</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  err <span class="token operator">:=</span> <span class="token function">proverbs</span><span class="token punctuation">(</span><span class="token string">&quot;proverbs.txt&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></span>
<span class="line">    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="defer-关键字" tabindex="-1"><a class="header-anchor" href="#defer-关键字"><span>defer 关键字</span></a></h4><p>使用 defer 关键字，Go 可以确保所有 deferred 的动作可以在函数返回前执行</p><p>可以 defer 任意的函数和方法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">proverbs</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> err</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Errors are values.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> err</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Don&#39;t just check errors, handle them gracefully.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> err</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>defer 并不是专门做错误处理的</p><p>defer 可以消除必须时刻惦记执行资源释放的负担</p><h4 id="有创意的错误处理" tabindex="-1"><a class="header-anchor" href="#有创意的错误处理"><span>有创意的错误处理</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> safeWriter <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	w   io<span class="token punctuation">.</span>Writer</span>
<span class="line">	err <span class="token builtin">error</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>sw <span class="token operator">*</span>safeWriter<span class="token punctuation">)</span> <span class="token function">writeln</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> sw<span class="token punctuation">.</span>err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token boolean">_</span><span class="token punctuation">,</span> sw<span class="token punctuation">.</span>err <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>sw<span class="token punctuation">.</span>w<span class="token punctuation">,</span> s<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">proverbs</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> err</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	sw <span class="token operator">:=</span> safeWriter<span class="token punctuation">{</span>w<span class="token punctuation">:</span> f<span class="token punctuation">}</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Errors are values.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Don&#39;t just check errors, handle them gracefully.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Don&#39;t panic.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Make the zero value useful.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;The bigger the interface, the weaker the abstraction.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;interface{} says nothing.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Gofmt&#39;s style is no one&#39;s favorite, yet gofmt is everyone&#39;s favorite.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Documentation is for users.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;A little copying is better than a little dependency.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Clear is better than clever.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Concurrency is not parallelism.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Don&#39;t communicate by sharing memory, share memory by communicating.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	sw<span class="token punctuation">.</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token string">&quot;Channels orchestrate; mutexes serialize.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">return</span> sw<span class="token punctuation">.</span>err</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="new-error" tabindex="-1"><a class="header-anchor" href="#new-error"><span>New error</span></a></h4><p>errors 包里有一个构造用的 New 函数，它接收 string 来作为参数用来表示错误信息，该函数返回 error 类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">const</span> rows<span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Sudoku 数独</span></span>
<span class="line"><span class="token keyword">type</span> Grid <span class="token punctuation">[</span>rows<span class="token punctuation">]</span><span class="token punctuation">[</span>columns<span class="token punctuation">]</span><span class="token builtin">int8</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Set</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Grid<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">,</span> digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;out of bounds&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  g<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> digit</span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> row <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> row <span class="token operator">&gt;=</span> rows <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> column <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> column <span class="token operator">&gt;=</span> columns <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> g Grid</span>
<span class="line">  err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;An error occurred: %v.\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>错误信息应具有信息性</p><p>可以把错误信息当作用户界面的一部分，无论对最终用户还是开发者</p></blockquote><h4 id="按需返回错误" tabindex="-1"><a class="header-anchor" href="#按需返回错误"><span>按需返回错误</span></a></h4><p>按照惯例，包含错误信息的变量名应以 Err 开头</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">const</span> rows<span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Sudoku 数独</span></span>
<span class="line"><span class="token keyword">type</span> Grid <span class="token punctuation">[</span>rows<span class="token punctuation">]</span><span class="token punctuation">[</span>columns<span class="token punctuation">]</span><span class="token builtin">int8</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token comment">// ErrBounds 表示数字越界</span></span>
<span class="line">  ErrBounds <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;out of bounds&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// ErrDigit 表示数字无效</span></span>
<span class="line">  ErrDigit <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid digit&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Set</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Grid<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">,</span> digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> ErrBounds</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  g<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> digit</span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> row <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> row <span class="token operator">&gt;=</span> rows <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> column <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> column <span class="token operator">&gt;=</span> columns <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> g Grid</span>
<span class="line">  err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">switch</span> err <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> ErrBounds<span class="token punctuation">,</span> ErrDigit<span class="token punctuation">:</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;error!!!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>errors.New 这个构造函数是使用指针实现的，所以上例 switch 语句比较的是内存地址，而不是错误包含的文字信息</p></blockquote><h4 id="自定义错误类型" tabindex="-1"><a class="header-anchor" href="#自定义错误类型"><span>自定义错误类型</span></a></h4><p>error 类型是一个内置的接口：任何类型只要实现了返回 string 的 Error() 方法就满足了该接口</p><p>可以创建新的错误类型</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">const</span> rows<span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Sudoku 数独</span></span>
<span class="line"><span class="token keyword">type</span> Grid <span class="token punctuation">[</span>rows<span class="token punctuation">]</span><span class="token punctuation">[</span>columns<span class="token punctuation">]</span><span class="token builtin">int8</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token comment">// ErrBounds 表示数字越界</span></span>
<span class="line">	ErrBounds <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;out of bounds&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// ErrDigit 表示数字无效</span></span>
<span class="line">	ErrDigit <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid digit&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> SudokuError <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>se SudokuError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> se <span class="token punctuation">{</span></span>
<span class="line">		s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Set</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Grid<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">,</span> digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> errs SudokuError</span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		errs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>errs<span class="token punctuation">,</span> ErrBounds<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">validDigit</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		errs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>errs<span class="token punctuation">,</span> ErrDigit<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> errs</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	g<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> digit</span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> row <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> row <span class="token operator">&gt;=</span> rows <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> column <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> column <span class="token operator">&gt;=</span> columns <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">validDigit</span><span class="token punctuation">(</span>digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> digit <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> digit <span class="token operator">&lt;=</span> <span class="token number">9</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> g Grid</span>
<span class="line">	err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">switch</span> err <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">case</span> ErrBounds<span class="token punctuation">,</span> ErrDigit<span class="token punctuation">:</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;error!!!&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">default</span><span class="token punctuation">:</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error：&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>按照惯例，自定义错误类型的名字应以 Error 结尾 有时候名字就是 Error，例如 url.Error</p></blockquote><h4 id="类型断言" tabindex="-1"><a class="header-anchor" href="#类型断言"><span>类型断言</span></a></h4><p>上例中，可以使用类型断言来访问每一种错误</p><p>使用类型断言，可以把接口类型转化成底层的具体类型，例如 <code>err.(SudokuError)</code></p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">const</span> rows<span class="token punctuation">,</span> columns <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Sudoku 数独</span></span>
<span class="line"><span class="token keyword">type</span> Grid <span class="token punctuation">[</span>rows<span class="token punctuation">]</span><span class="token punctuation">[</span>columns<span class="token punctuation">]</span><span class="token builtin">int8</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token comment">// ErrBounds 表示数字越界</span></span>
<span class="line">	ErrBounds <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;out of bounds&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// ErrDigit 表示数字无效</span></span>
<span class="line">	ErrDigit <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid digit&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> SudokuError <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>se SudokuError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> se <span class="token punctuation">{</span></span>
<span class="line">		s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Set</span></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Grid<span class="token punctuation">)</span> <span class="token function">Set</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">,</span> digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> errs SudokuError</span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		errs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>errs<span class="token punctuation">,</span> ErrBounds<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">validDigit</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		errs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>errs<span class="token punctuation">,</span> ErrDigit<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> errs</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	g<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> digit</span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">nil</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">inBounds</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> column <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> row <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> row <span class="token operator">&gt;=</span> rows <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">if</span> column <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> column <span class="token operator">&gt;=</span> columns <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">validDigit</span><span class="token punctuation">(</span>digit <span class="token builtin">int8</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> digit <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> digit <span class="token operator">&lt;=</span> <span class="token number">9</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">var</span> g Grid</span>
<span class="line">	err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">/* 相较于上例，只变动此处 */</span></span>
<span class="line">    <span class="token keyword">if</span> errs<span class="token punctuation">,</span> ok <span class="token operator">:=</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>SudokuError<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d error(s) occurred:\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> errs <span class="token punctuation">{</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;- %v\n&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>如果类型满足多个接口，那么类型断言可使它从一个接口类型转化为另一个接口类型</p><h4 id="如何-panic" tabindex="-1"><a class="header-anchor" href="#如何-panic"><span>如何 panic</span></a></h4><p>Go 里有一个和其他语言异常类似的机制：panic</p><p>实际上，panic 很少出现</p><p>创建 panic：调用内置的 panic 函数</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;invalid operation&quot;</span><span class="token punctuation">)</span> <span class="token comment">// panic 的参数可以是任意类型</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="错误值、panic、os-exit" tabindex="-1"><a class="header-anchor" href="#错误值、panic、os-exit"><span>错误值、panic、os.Exit？</span></a></h4><p>通常，更推荐使用错误值，其次才是 panic</p><p>panic 比 os.Exit() 更好：panic 后会执行所有 defer 操作，而 os.Exit() 不会</p><p>有时候 Go 程序会 panic 而不是返回错误值</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> zero <span class="token builtin">int</span></span>
<span class="line">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> zero<span class="token punctuation">)</span> <span class="token comment">// panic: runtime error: integer divide by zero</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="保持冷静并继续" tabindex="-1"><a class="header-anchor" href="#保持冷静并继续"><span>保持冷静并继续</span></a></h4><p>为了防止 panic 导致程序崩溃，Go 提供了 recover 函数</p><p>defer 的动作会在函数返回前执行，即使发生了 panic</p><p>但如果 defer 的函数调用了 recover，panic 就会停止，程序将继续运行</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;run time panic: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token comment">// 2023/09/10 11:23:52 run time panic: I forgot my towel</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;I forgot my towel&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="goroutine-和-并发-concurrent" tabindex="-1"><a class="header-anchor" href="#goroutine-和-并发-concurrent"><span>goroutine 和 并发（concurrent）</span></a></h3><h4 id="goroutine" tabindex="-1"><a class="header-anchor" href="#goroutine"><span>goroutine</span></a></h4><p>在 Go 中，独立的任务叫做 goroutine</p><ul><li>goroutine 和其他语言的协程、进程、线程都有相似之处，但并不完全相同</li><li>goroutine 创建效率非常高</li><li>Go 能直截了当地协同多个并发（concurrent）操作</li></ul><p>在 Go 里，无需修改现有顺序式的代码，就可以通过 goroutine 以并发的方式运行任意数量的任务</p><h4 id="启动-goroutine" tabindex="-1"><a class="header-anchor" href="#启动-goroutine"><span>启动 goroutine</span></a></h4><p>只需在调用前加一个 go 关键字，就可以让函数/方法以 goroutine 方式运行</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;... snore ...&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">/* 分支线路 */</span></span>
<span class="line">  <span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">/* 主线路 */</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;i&#39;m waiting&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="不止一个-goroutine" tabindex="-1"><a class="header-anchor" href="#不止一个-goroutine"><span>不止一个 goroutine</span></a></h4><p>每次使用 go 关键字都会产生一个新的 goroutine</p><p>表面上看，goroutine 似乎在同时运行，但由于计算机处理单元有限，其实技术上来说，这些 goroutine 不是真的在同时运行</p><ul><li>计算机处理器会使用“分时”技术，在多个 goroutine 上轮流花费一些时间</li><li>在使用 goroutine 时，各个 goroutine 的执行顺序无法确定</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;... snore ...&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="通道-channel" tabindex="-1"><a class="header-anchor" href="#通道-channel"><span>通道 channel</span></a></h4><p>channel 可以在多个 goroutine 之间安全地传值</p><p>通道可以用作变量、函数参数、结构体字段...</p><p>创建通道用 make 函数，并指定其传输数据的类型 <code>c := make(chan int)</code></p><h4 id="通道-channel-发送、接收" tabindex="-1"><a class="header-anchor" href="#通道-channel-发送、接收"><span>通道 channel 发送、接收</span></a></h4><p>使用左箭头操作符 &lt;- 向通道发送值或从通道接收值</p><ul><li>发送值：<code>c &lt;- 1</code></li><li>接收值：<code>r := &lt;- c</code></li></ul><p>发送操作会等待直到另一个 goroutine 尝试对该通道进行接收操作为止</p><ul><li>执行发送操作的 goroutine 在等待期间将无法执行其他操作</li><li>未在等待通道操作的 goroutine 可以继续自由地运行</li></ul><p>执行接收操作的 goroutine 将等待直到另一个 goroutine 尝试向该通道进行发送操作为止</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">    gopherID <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c</span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gopher&quot;</span><span class="token punctuation">,</span> gopherID<span class="token punctuation">,</span> <span class="token string">&quot;has finished sleeping&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;... snore ...&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span></span>
<span class="line">  c <span class="token operator">&lt;-</span> id</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="使用-select-处理多个通道" tabindex="-1"><a class="header-anchor" href="#使用-select-处理多个通道"><span>使用 select 处理多个通道</span></a></h4><p>等待不同类型的值</p><p>time.After 函数，返回一个通道，该通道在指定时间后会接收到一个值（发送该值的 goroutine 是 Go 运行时的一部分）</p><p>select 和 switch 有点像</p><ul><li>该语句包含的每个 case 都持有一个通道，用来发送或接收数据</li><li>select 会等待直到某个 case 分支的操作就绪，然后就会执行该 case 的分支</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">go</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  timeout <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">case</span> gopherID <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">:</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gopher&quot;</span><span class="token punctuation">,</span> gopherID<span class="token punctuation">,</span> <span class="token string">&quot;has finished sleeping&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>timeout<span class="token punctuation">:</span></span>
<span class="line">      fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;my patience ran out&quot;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">sleepyGopher</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span> <span class="token comment">// 0~4s</span></span>
<span class="line">  c <span class="token operator">&lt;-</span> id</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>注意：</p><p>即使已经停止等待 goroutine，但只要 main 函数还没返回，仍在运行的 goroutine 将会继续占用内存</p><p>select 语句在不包含任何 case 的情况下将永远等下去</p></blockquote><h4 id="nil-通道" tabindex="-1"><a class="header-anchor" href="#nil-通道"><span>nil 通道</span></a></h4><p>如果不使用 make 初始化通道，那么通道变量的值就是 nil（零值）</p><p>对 nil 通道进行发送或接收不会引起 panic，但会导致永久阻塞</p><p>对 nil 哦那个到执行 close 函数，会引发 panic</p><p>nil 通道的用处：</p><ul><li>对于包含 select 语句的循环，如果不希望每次循环都等待 select 所涉及的所有的通道，那么就可以先将某些通道设为 nil，等到发送值准备就绪之后，再将通道变成一个非 nil 值并执行发送操作</li></ul><h4 id="阻塞和死锁" tabindex="-1"><a class="header-anchor" href="#阻塞和死锁"><span>阻塞和死锁</span></a></h4><p>当 goroutine 在等待通道的发送或接收时，就说它被阻塞了</p><p>除了 goroutine 本身占用少量的内存外，被阻塞的 goroutine 并不消耗任何其他资源</p><p>当一个或多个 goroutine 因为某些永远无法发生的事情被阻塞时，则称这种情况为死锁。而出现死锁的程序通常会崩溃或挂起</p><p>引发死锁的例子：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">/* 下面这行代码可以解除死锁 */</span></span>
<span class="line">  <span class="token comment">// go func () {c &lt;- 2}</span></span>
<span class="line">  <span class="token operator">&lt;-</span> c <span class="token comment">// fatal error: all goroutines are asleep - deadlock!</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="地鼠装配线" tabindex="-1"><a class="header-anchor" href="#地鼠装配线"><span>地鼠装配线</span></a></h4><p><img src="/study-notes/assets/assembly-line-BlmkLYUt.png" alt="图片"></p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a bad apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye all&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">		upstream <span class="token operator">&lt;-</span> v</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">close</span><span class="token punctuation">(</span>upstream<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>downstream<span class="token punctuation">,</span> upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		item<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> downstream</span>
<span class="line">		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span>
<span class="line">			<span class="token function">close</span><span class="token punctuation">(</span>upstream<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		<span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;bad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			upstream <span class="token operator">&lt;-</span> item</span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">PrintGopher</span><span class="token punctuation">(</span>downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> downstream</span>
<span class="line">		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span></span>
<span class="line">			<span class="token keyword">break</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	c0 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> c1<span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">PrintGopher</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>Go 允许在没有值可供发送的情况下通过 close 函数关闭通道，例如 <code>close(c)</code></p><p>通道被关闭后无法写入任何值，如果尝试写入将引发 panic</p><p>尝试读取被关闭的通道会获得与通道类型对应的零值</p><p>注意：如果循环里读取一个已关闭的通道，并没检查通道是否关闭，那么该循环可能会一直运转下去，耗费大量 CPU 时间</p><p>执行以下代码可知通道是否被关闭</p><ul><li>v, ok := &lt;-c</li></ul><h4 id="常用模式" tabindex="-1"><a class="header-anchor" href="#常用模式"><span>常用模式</span></a></h4><p>从通道里面读取值，直到它关闭为止</p><ul><li>可以使用 range 关键字达到该目的</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a bad apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye all&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">{</span></span>
<span class="line">		upstream <span class="token operator">&lt;-</span> v</span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	<span class="token function">close</span><span class="token punctuation">(</span>upstream<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>downstream<span class="token punctuation">,</span> upstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> item <span class="token operator">:=</span> <span class="token keyword">range</span> downstream <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;bad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      upstream <span class="token operator">&lt;-</span> item</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">close</span><span class="token punctuation">(</span>upstream<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">PrintGopher</span><span class="token punctuation">(</span>downstream <span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> downstream <span class="token punctuation">{</span></span>
<span class="line">    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	c0 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">	c1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">sourceGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">go</span> <span class="token function">filterGopher</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> c1<span class="token punctuation">)</span></span>
<span class="line">	<span class="token function">PrintGopher</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="并发状态" tabindex="-1"><a class="header-anchor" href="#并发状态"><span>并发状态</span></a></h3><ul><li>共享值</li><li>竞争条件（race condition）</li></ul><h4 id="go-的互斥锁-mutex-mutual-exclusive" tabindex="-1"><a class="header-anchor" href="#go-的互斥锁-mutex-mutual-exclusive"><span>Go 的互斥锁（mutex = mutual exclusive）</span></a></h4><ul><li>Lock()，Unlock()</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex</span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">defer</span> mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// The lock is held until we return from the function</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><blockquote><p>互斥锁定义在被保护的变量之上</p></blockquote><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> Visited <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">  mu sync<span class="token punctuation">.</span>Mutex</span>
<span class="line">  visited <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>Visited<span class="token punctuation">)</span> <span class="token function">VisitLink</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span></span>
<span class="line">  v<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">defer</span> v<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  count <span class="token operator">:=</span> v<span class="token punctuation">.</span>visited<span class="token punctuation">[</span>url<span class="token punctuation">]</span></span>
<span class="line">  count<span class="token operator">++</span></span>
<span class="line">  v<span class="token punctuation">.</span>visited<span class="token punctuation">[</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> count</span>
<span class="line">  <span class="token keyword">return</span> count</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="互斥锁的隐患" tabindex="-1"><a class="header-anchor" href="#互斥锁的隐患"><span>互斥锁的隐患</span></a></h4><ul><li>死锁</li></ul><p>为保证互斥锁的安全使用，须遵循以下规则：</p><ul><li>尽可能地简化互斥锁保护的代码</li><li>对每一份共享状态只使用一个互斥锁</li></ul><h4 id="长时间运行的工作进程" tabindex="-1"><a class="header-anchor" href="#长时间运行的工作进程"><span>长时间运行的工作进程</span></a></h4><ul><li>工作进程（worker） <ul><li>通常会被写成包含 select 语句的 for 循环</li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  n <span class="token operator">:=</span> <span class="token number">0</span></span>
<span class="line">  next <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">select</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>next<span class="token punctuation">:</span></span>
<span class="line">        n<span class="token operator">++</span></span>
<span class="line">        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line">        next <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">for</span> <span class="token punctuation">{</span></span>
<span class="line">		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="事件循环和-goroutine" tabindex="-1"><a class="header-anchor" href="#事件循环和-goroutine"><span>事件循环和 goroutine</span></a></h4><ul><li>事件循环（event loop）</li><li>中心循环（central loop）</li></ul><p>Go 通过提供 goroutine 作为核心概念，消除了对中心循环的需求</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2025-05-28T10:37:47.000Z" data-allow-mismatch>2025/5/28 10:37</time></div><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/study-notes/assets/app-D9fezM6y.js" defer></script>
  </body>
</html>
