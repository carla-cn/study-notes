<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/study-notes/favicon.ico"><title>瓢儿白施肥记</title><meta name="description" content="记录一些学习内容">
    <link rel="preload" href="/study-notes/assets/style-BRJf4XC4.css" as="style"><link rel="stylesheet" href="/study-notes/assets/style-BRJf4XC4.css">
    <link rel="modulepreload" href="/study-notes/assets/app-D9fezM6y.js"><link rel="modulepreload" href="/study-notes/assets/index.html-C-iDq3MW.js">
    <link rel="prefetch" href="/study-notes/assets/index.html-CgflfRB-.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-B34h2Jk0.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BW535v_e.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DIHIQiSf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DZrbXYrC.js" as="script"><link rel="prefetch" href="/study-notes/assets/01.html-BO8Xsva7.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-CA0yKzuK.js" as="script"><link rel="prefetch" href="/study-notes/assets/continuous.html-5GavGPKu.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-CGg8PqqT.js" as="script"><link rel="prefetch" href="/study-notes/assets/matrix.html-C16KO3iA.js" as="script"><link rel="prefetch" href="/study-notes/assets/01.html-Bh2SeMAK.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-cZg359Qk.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DhRP-Ntg.js" as="script"><link rel="prefetch" href="/study-notes/assets/ali-iconfont.html-i0CTIv7W.js" as="script"><link rel="prefetch" href="/study-notes/assets/git.html-dcHlXWOR.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BzJzfHoY.js" as="script"><link rel="prefetch" href="/study-notes/assets/json-server.html-B5fTSOrf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BwhrVZQ1.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-Dw2Gd7a9.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BplpYS6e.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-Bl-LRITq.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-GHCF7Flf.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BDNACifz.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DpTa0yfy.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-BtM3uTMl.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-qTUlGD2e.js" as="script"><link rel="prefetch" href="/study-notes/assets/index.html-DtSplwMN.js" as="script"><link rel="prefetch" href="/study-notes/assets/404.html-C3r3GZUB.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/study-notes/"><img class="vp-site-logo" src="/study-notes/imgs/logo.png" alt="瓢儿白施肥记"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">瓢儿白施肥记</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数学"><span class="title">数学</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数学"><span class="title">数学</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/wzw/" aria-label="最优化：建模、算法与理论"><!--[--><!--[--><!--]--><!--]-->最优化：建模、算法与理论<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/eg/" aria-label="英语表达"><!--[--><!--[--><!--]--><!--]-->英语表达<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="通用"><span class="title">通用</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="通用"><span class="title">通用</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/tool/" aria-label="工具"><!--[--><!--[--><!--]--><!--]-->工具<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/ui/" aria-label="UI"><!--[--><!--[--><!--]--><!--]-->UI<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/frontend/" aria-label="前端"><!--[--><!--[--><!--]--><!--]-->前端<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/study-notes/general/backend/" aria-label="后端"><!--[--><!--[--><!--]--><!--]-->后端<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/carla-cn" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数学"><span class="title">数学</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数学"><span class="title">数学</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/wzw/" aria-label="最优化：建模、算法与理论"><!--[--><!--[--><!--]--><!--]-->最优化：建模、算法与理论<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/eg/" aria-label="英语表达"><!--[--><!--[--><!--]--><!--]-->英语表达<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/math/algorithm/" aria-label="算法"><!--[--><!--[--><!--]--><!--]-->算法<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="通用"><span class="title">通用</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="通用"><span class="title">通用</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/tool/" aria-label="工具"><!--[--><!--[--><!--]--><!--]-->工具<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/ui/" aria-label="UI"><!--[--><!--[--><!--]--><!--]-->UI<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/study-notes/general/frontend/" aria-label="前端"><!--[--><!--[--><!--]--><!--]-->前端<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/study-notes/general/backend/" aria-label="后端"><!--[--><!--[--><!--]--><!--]-->后端<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/carla-cn" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h2 id="使用-go-创建-web-应用" tabindex="-1"><a class="header-anchor" href="#使用-go-创建-web-应用"><span>使用 Go 创建 Web 应用</span></a></h2><ul><li>处理请求</li><li>模板</li><li>中间件</li><li>存储数据</li><li>HTTPS，HTTP2</li><li>测试</li><li>部署</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&quot;net/http&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hell world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// 传入 nil，即 DefaultServeMux</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="处理-handle-请求" tabindex="-1"><a class="header-anchor" href="#处理-handle-请求"><span>处理（Handle）请求</span></a></h3><ul><li>如何处理（Handle）Web 请求 <ul><li>http.Handle 函数</li><li>http.HandleFunc 函数</li></ul></li></ul><p><img src="/study-notes/assets/handler-BsYuLGGq.png" alt="handler"></p><h4 id="创建-web-server" tabindex="-1"><a class="header-anchor" href="#创建-web-server"><span>创建 Web Server</span></a></h4><p>http.ListenAndServe(addr string, handler Handler) error</p><ul><li>addr：监听的地址，如果为空字符串，则使用 &quot;:http&quot;，即监听 80 端口</li><li>handler：处理请求的 Handler，如果为空，则使用 DefaultServeMux</li></ul><p>DefaultServeMux 是一个 multiplexer，即多路复用器，用于将请求分发到不同的处理器（可以看作是路由器）</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>http.Server 是一个 struct</p><ul><li>Addr 字段表示网络地址 <ul><li>如果为 &quot;&quot;，则使用 &quot;:http&quot;，即监听所有网络接口的 80 端口</li></ul></li><li>Handler 字段 <ul><li>如果为 nil，则使用 DefaultServeMux</li></ul></li><li>ListenAndServe 方法</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// serve := &amp;http.Server{</span></span>
<span class="line">serve <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span>    <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	Handler<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">serve<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>上面两种创建 Web Server 的方式，都只能使用 http。如果要用 https，则需要使用同理的 http.ListenAndServeTLS() 和 server.ListenAndServeTLS() 方法</p><h4 id="handler" tabindex="-1"><a class="header-anchor" href="#handler"><span>Handler</span></a></h4><p>Handler 是一个接口</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> Handler <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">ServeHTTP</span><span class="token punctuation">(</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>Request<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>自己实现 Handler 接口</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> myHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>myHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	mh <span class="token operator">:=</span> myHandler<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Handler<span class="token punctuation">:</span> <span class="token operator">&amp;</span>mh<span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><img src="/study-notes/assets/more-handler-BqGlMIYB.png" alt="handler"></p><h4 id="defaultservemux" tabindex="-1"><a class="header-anchor" href="#defaultservemux"><span>DefaultServeMux</span></a></h4><p>DefaultServeMux 是一个 multiplexer，即多路复用器，用于将请求分发到不同的处理器（可以看作是路由器）</p><p><img src="/study-notes/assets/default-serve-mux-CSvKv5M7.png" alt="DefaultServeMux"></p><h4 id="多个-handler-http-handle" tabindex="-1"><a class="header-anchor" href="#多个-handler-http-handle"><span>多个 Handler - http.Handle</span></a></h4><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">Handle</span><span class="token punctuation">(</span>pattern <span class="token builtin">string</span><span class="token punctuation">,</span> handler Handler<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>不指定 Server struct 里面的 Handler 字段值（指定为 nil）</p><p>可以使用 http.Handle 将某个 Handler 附加到 DefaultServeMux 上</p><ul><li>http 包有一个 Handle 函数</li><li>ServerMux struct 也有一个 Handle 方法</li></ul><p>如果调用 http.Handle，实际上调用的是 DefaultServeMux 的 Handle 方法</p><ul><li>DefaultServeMux 就是 ServerMux 的指针变量</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> helloHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>helloHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> aboutHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>aboutHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;About!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	hello <span class="token operator">:=</span> helloHandler<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	about <span class="token operator">:=</span> aboutHandler<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Handler<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token comment">// DefaultServeMux</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hello<span class="token punctuation">)</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/about&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>about<span class="token punctuation">)</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="handler-函数-http-handlefunc" tabindex="-1"><a class="header-anchor" href="#handler-函数-http-handlefunc"><span>Handler 函数 - http.HandleFunc</span></a></h4><p>Handler 函数就是那些行为与 handler 类似的函数：</p><ul><li>Handler 函数的签名与 ServeHTTP 方法的签名一样，接收 <ul><li>http.ResponseWriter</li><li>指向 http.Request 的指针</li></ul></li></ul><p>http.HandleFunc 原理</p><ul><li>Go 有一个函数类型 HandlerFunc。可以将某个具有适当签名的函数 f，适配成为一个 Handler，而这个 Handler 就是调用 f 本身</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> helloHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>helloHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> aboutHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>aboutHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;About!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">welcome</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Welcome!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	hello <span class="token operator">:=</span> helloHandler<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	about <span class="token operator">:=</span> aboutHandler<span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span>    <span class="token string">&quot;localhost:8081&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Handler<span class="token punctuation">:</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token comment">// DefaultServeMux</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hello<span class="token punctuation">)</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/about&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>about<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Home!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">// http.HandleFunc(&quot;/welcome&quot;, welcome)</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/welcome&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span>welcome<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>http.HandleFunc</p><ul><li>http.HandleFunc(pattern string, handler func(ResponseWriter, *Request))</li><li>type HandlerFunc func(ResponseWriter, *Request)</li></ul><h4 id="内置的-handlers" tabindex="-1"><a class="header-anchor" href="#内置的-handlers"><span>内置的 handlers</span></a></h4><ul><li>NotFoundHandler</li><li>RedirectHandler</li><li>StripPrefix</li><li>TimeoutHandler</li><li>FileServer</li></ul><p>http.NotFoundHandler</p><ul><li>func NotFoundHandler() Handler</li><li>返回一个 handler，它给每个请求的响应都是 “404 page not found”</li></ul><p>http.RedirectHandler</p><ul><li>func RedirectHandler(url string, code int) Handler</li><li>返回一个 handler，它把每个请求使用给定的状态码跳转到指定的 URL <ul><li>url，要跳转到的 URL</li><li>code，跳转的状态码（3xx），常见的：StatusMovedPermanently，StatusFound，StatusSeeOther，StatusTemporaryRedirect，StatusPermanentRedirect</li></ul></li></ul><p>http.StripPrefix</p><ul><li>func StripPrefix(prefix string, h Handler) Handler</li><li>返回一个 handler，它从请求的 URL 中去掉指定的前缀，然后再调用另一个 handler <ul><li>如果请求的 URL 与提供的前缀不符，那么 404</li></ul></li><li>略像中间件 <ul><li>prefix，URL 将要被移除的字符串前缀</li><li>h，是一个 handler，在移除字符串前缀之后，这个 handler 将会收到请求</li></ul></li><li>修饰了另一个 handler</li></ul><p>http.TimeoutHandler</p><ul><li>func TimeoutHandler(h Handler, dt time.Duration, msg string) Handler</li><li>返回一个 handler，它在指定的时间内处理请求，如果超时，就返回一个错误信息</li><li>也相当于是一个修饰器 <ul><li>h，将要被修饰的 handler</li><li>dt，第一个 handler 允许的处理时间</li><li>msg，如果超时，那么就把 msg 返回给请求，表示响应时间过长</li></ul></li></ul><p>http.FileServer</p><ul><li>func FileServer(root FileSystem) Handler</li><li>返回一个 handler，它会在 root 中寻找文件，并将其提供给请求</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> FileSystem <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>File<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>使用时需要用到操作系统的文件系统，所以还需要委托给 <ul><li>type Dir string</li><li>func (d Dir) Open(name string) (File, error)</li></ul></li></ul><p>例子</p><p><img src="/study-notes/assets/file-server-demo-COUD7F11.png" alt="FileServer"></p><p>通过 localhost:8081/ 访问 index.html</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">/* 方法1 */</span></span>
<span class="line"><span class="token comment">// http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span class="token comment">// 	http.ServeFile(w, r, &quot;wwwroot&quot; + r.URL.Path)</span></span>
<span class="line"><span class="token comment">// })</span></span>
<span class="line"><span class="token comment">// http.ListenAndServe(&quot;:8081&quot;, nil)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/* 方法2 */</span></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8081&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">FileServer</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">Dir</span><span class="token punctuation">(</span><span class="token string">&quot;wwwroot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h3 id="请求" tabindex="-1"><a class="header-anchor" href="#请求"><span>请求</span></a></h3><ul><li>HTTP 请求</li><li>Request</li><li>URL</li><li>Header</li><li>Body</li></ul><h4 id="http-消息" tabindex="-1"><a class="header-anchor" href="#http-消息"><span>HTTP 消息</span></a></h4><ul><li>HTTP Request 和 HTTP Response（请求和响应）</li><li>它们具有相同的结构 <ul><li>请求（响应）行</li><li>0 个或多个 Header</li><li>空行</li><li>可选的消息体（Body）</li></ul></li><li>net/http 包提供了用于表示 HTTP 消息的结构</li></ul><h4 id="请求-request" tabindex="-1"><a class="header-anchor" href="#请求-request"><span>请求 Request</span></a></h4><ul><li>Request 是个 struct，代表了客户端发送的 HTTP 请求消息</li><li>重要的字段 <ul><li>URL</li><li>Header</li><li>Body</li><li>Form、PostForm、MultipartForm</li></ul></li><li>也可以通过 Request 的方法访问请求中的 Cookie、URL、User Agent 等信息</li><li>Request 既可以代表发送到服务器的请求，又可代表客户端发出的请求</li></ul><p>请求的 URL</p><ul><li>Request 的 URL 字段就代表了请求行（请求信息第一行）里面的部分内容</li><li>URL 字段是指向 url.URL 类型的一个指针，url.URL 是一个 struct:</li></ul><p>URL 的通用格式：<code>scheme://[userinfo@]host/path[?query][#fragment]</code> 不以斜杠开头的 URL 被解释为：<code>scheme:opaque[?query][#fragment]</code></p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> URL <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	Scheme		<span class="token builtin">string</span></span>
<span class="line">	Opaque		<span class="token builtin">string</span>		<span class="token comment">// 编码后的不透明数据</span></span>
<span class="line">	User		<span class="token operator">*</span>Userinfo	<span class="token comment">// 用户名和密码信息</span></span>
<span class="line">	Host		<span class="token builtin">string</span>		<span class="token comment">// host 或 host:port</span></span>
<span class="line">	Path		<span class="token builtin">string</span></span>
<span class="line">	RawPath		<span class="token builtin">string</span>		<span class="token comment">// 编码后的 path，保留了转义符</span></span>
<span class="line">	ForceQuery	<span class="token builtin">bool</span>		<span class="token comment">// 是否在 URL 中添加 ? 强制添加查询参数</span></span>
<span class="line">	RawQuery	<span class="token builtin">string</span>		<span class="token comment">// 编码后的查询字符串，没有 &#39;?&#39;</span></span>
<span class="line">	Fragment	<span class="token builtin">string</span>		<span class="token comment">// 引用的片段（文档位置），没有 &#39;#&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>URL Query</p><ul><li>RawQuery 会提供实际查询的字符串</li><li>例如：<code>http://localhost:8080/?name=abc&amp;age=18</code><ul><li>RawQuery 为：<code>name=abc&amp;age=18</code></li></ul></li></ul><p>URL Fragment</p><ul><li>如果从浏览器发出的请求，就无法提取出 Fragment 字段的值 <ul><li>浏览器在发送请求时会把 fragment 部分去掉</li></ul></li><li>但不是所有的请求都是从浏览器发出的（例如从 http 客户端包）</li></ul><p>Request Header</p><ul><li>请求和响应（Request、Response）的 headers 是通过 Header 类型来描述的，它是一个 map，用来表述 HTTP Header 里的 Key-Value 对</li><li>Header map 的 key 是 string 类型，value 是一个字符串切片 []string</li><li>设置 key 的时候会创建一个空的 []string 作为 value，value 里面第一个元素就是新 header 的值</li><li>为指定的 key 添加一个新的 header 值，执行 append 操作即可</li><li>r.Header，返回 map</li><li>r.Header[&quot;Accept-Encoding&quot;]，返回 [gzip, deflate]，[]string 类型</li><li>r.Header.Get(&quot;Accept-Encoding&quot;)，返回 gzip, deflate，string 类型</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8081&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/header&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Header<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Header<span class="token punctuation">[</span><span class="token string">&quot;Accept-Encoding&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;Accept-Encoding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>Request Body</p><ul><li>请求和响应的 bodies 都是使用 Body 字段来表示的</li><li>Body 是一个 io.ReadCloser 接口</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> ReadCloser <span class="token keyword">interface</span> <span class="token punctuation">{</span></span>
<span class="line">	Reader</span>
<span class="line">	Closer</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>Reader 接口定义了一个 Open() 方法 <ul><li>参数：[]byte</li><li>返回：byte 的数量、可选的错误</li></ul></li><li>Closer 接口定义了一个 Close() 方法 <ul><li>返回：可选的错误</li></ul></li><li>想要读取请求 Body 的内容，可以调用 Body 的 Read 方法</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8081&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/post&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	length <span class="token operator">:=</span> r<span class="token punctuation">.</span>ContentLength</span>
<span class="line">	body <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span></span>
<span class="line">	r<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> body<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="查询参数-query-parameters" tabindex="-1"><a class="header-anchor" href="#查询参数-query-parameters"><span>查询参数（Query Parameters）</span></a></h4><p>URL Query</p><ul><li>http://localhost:8080/?name=abc&amp;age=18 <ul><li>r.URL.RawQuery 为：<code>name=abc&amp;age=18</code>（实际查询的原始字符串）</li><li>r.URL.Query() 方法返回 map[string][]string <ul><li>map 的 key 是 string 类型</li><li>map 的 value 是 []string 类型</li></ul></li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// http://localhost:8081/query?id=123&amp;name=张三&amp;id=466&amp;name=李四</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8081&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/query&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		url <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL</span>
<span class="line">		query <span class="token operator">:=</span> url<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		id <span class="token operator">:=</span> query<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">		name <span class="token operator">:=</span> query<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span></span>
<span class="line">		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="form" tabindex="-1"><a class="header-anchor" href="#form"><span>Form</span></a></h4><p>Request 上的函数允许从 URL 或 / 和 Body 中提取数据，通过如下字段</p><ul><li>Form</li><li>PostForm</li><li>MultipartForm</li><li>FormValue</li><li>PostFormValue</li><li>FormFile</li><li>MultiPartReader</li></ul><p><strong>Form 里面的数据是 key-value 对</strong></p><p>通常的做法是：</p><ul><li>先调用 ParseForm 或 ParseMultipartForm 来解析 Request</li><li>然后相应地访问 Form、PostForm、MultipartForm 字段</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span></span>
<span class="line">  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8080/process<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/x-www-form-urlencoded<span class="token punctuation">&quot;</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Form<span class="token punctuation">)</span> <span class="token comment">// map[email:[2439639832@qq.com] name:[客户1号]]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>PostForm 字段</strong></p><ul><li>上例中，如果只想得到 name 这个 Key 的 Value，可以使用 r.Form[&quot;name&quot;]，它返回含有一个元素的 slice：[&quot;客户 1 号&quot;]</li><li>如果表单和 URL 里有同样的 Key，那么它们都会放在一个 slice 里：表单里的值靠前，URL 的值靠后</li><li>如果只想要表单的 key-value 对，不要 URL 的，可以使用 PostForm 字段</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span></span>
<span class="line highlighted">  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8080/process?name=客户2号<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/x-www-form-urlencoded<span class="token punctuation">&quot;</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line highlighted">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Form<span class="token punctuation">)</span> <span class="token comment">// map[email:[2439639832@qq.com] name:[客户1号 客户2号]]</span></span>
<span class="line highlighted">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>PostForm<span class="token punctuation">)</span> <span class="token comment">// map[email:[2439639832@qq.com] name:[客户1号]]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>MultipartForm 字段</strong></p><ul><li>PostForm 只支持 application/x-www-form-urlencoded 编码</li><li>要想得到 multipart/form-data 对，必须使用 MultipartForm 字段</li><li>要想使用 MultiPartForm 字段，必须先调用 ParseMultipartForm 方法 <ul><li>该方法会在必要时调用 ParseForm 方法</li><li>参数是需要读取数据的长度</li></ul></li><li>MultipartForm 只包含表单的 key-value 对</li><li>返回类型是一个 struct，这个 struct 里面有两个 map： <ul><li>key 是 string，value 是 []string</li><li>key 是 string，value 是 文件</li></ul></li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span></span>
<span class="line">  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8080/process?name=客户2号<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span></span>
<span class="line highlighted">  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">	Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	r<span class="token punctuation">.</span><span class="token function">ParseMultipartForm</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line highlighted">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MultipartForm<span class="token punctuation">)</span> <span class="token comment">// &amp;{map[email:[2439639832@qq.com] name:[客户1号]] map[]}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>FormValue 和 PostFormValue 方法</strong></p><ul><li>FormValue 会返回 Form 字段中指定 key 对应的第一个 value <ul><li>无需调用 ParseForm 或 ParseMultipartForm</li></ul></li><li>PostFormValue 也一样，但只能读取 PostForm 字段</li><li>FormValue 和 PostFormValue 都会调用 ParseMultipartForm 方法</li></ul><p><strong>上传文件</strong></p><p>multipart/form-data 最常见的应用场景就是上传文件</p><ul><li>首先调用 ParseMultiPartForm 方法</li><li>从 File 字段获得 FileHeader，调用其 Open 方法来获得文件</li><li>可以使用 io.ReadAll 函数把文件内容读取到 byte 切片里</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span></span>
<span class="line">  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:8080/process?name=客户2号<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	r<span class="token punctuation">.</span><span class="token function">ParseMultipartForm</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	fileHeader <span class="token operator">:=</span> r<span class="token punctuation">.</span>MultipartForm<span class="token punctuation">.</span>File<span class="token punctuation">[</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> fileHeader<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		data<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>FormFile 方法</strong></p><ul><li>上传文件还有一个简便方法：FormFile <ul><li>无需调用 ParseMultipartForm 方法</li><li>返回指定 key 对应的第一个 value</li><li>同时返回 File 和 FileHeader，以及错误信息</li><li>如果只上传一个文件，那么这种方式会快一些</li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// r.ParseMultipartForm(1024)</span></span>
<span class="line"></span>
<span class="line">	<span class="token comment">// fileHeader := r.MultipartForm.File[&quot;file&quot;][0]</span></span>
<span class="line">	<span class="token comment">// file, err := fileHeader.Open()</span></span>
<span class="line"></span>
<span class="line">	file<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FormFile</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">		data<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></span>
<span class="line">		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span></span>
<span class="line">			fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>MultiPartReader()</strong></p><ul><li>func (r *Request) MultiPartReader() (*multipart.Reader, error)</li><li>如果是 multipart/form-data 或 multipart 混合的 POST 请求 <ul><li>MultiPartReader 方法会返回一个 MIME multipart reader</li><li>否则返回一个错误</li></ul></li><li>可以使用该函数代替 ParseMultipartForm，来把请求的 body 作为 stream 进行处理 <ul><li>不是把表单作为一个对象来处理的，不是一次性获得整个 map</li><li>逐个检查来自表单的值，然后每次处理一个</li></ul></li></ul><h4 id="post-请求-json-body" tabindex="-1"><a class="header-anchor" href="#post-请求-json-body"><span>POST 请求 - JSON Body</span></a></h4><ul><li>不是所有的 POST 请求都来自 Form</li><li>客户端框架（例如 Angular 等）会议不同的方式对 POST 请求编码： <ul><li>jQuery 通常使用 application/x-www-form-urlencoded</li><li>Angular 通常使用 application/json</li></ul></li><li>ParseForm 方法无法处理 application/json</li></ul><h3 id="响应" tabindex="-1"><a class="header-anchor" href="#响应"><span>响应</span></a></h3><h4 id="responsewriter" tabindex="-1"><a class="header-anchor" href="#responsewriter"><span>ResponseWriter</span></a></h4><ul><li>从服务器向客户端返回响应需要使用 ResponseWriter</li><li>ResponseWriter 是一个接口，handler 用它来返回响应</li><li>真正支撑 ResponseWriter 的幕后 struct 是非导出的 http.response</li></ul><p><strong>写入到 ResponseWriter</strong></p><ul><li>Write 方法接收一个 byte 切片作为参数，然后把它写入到 HTTP 响应的 body 里</li><li>如果在 Write 方法被调用时， header 里面没有设定 content-type，那么数据的前 512 字节就会用来被检测 content type</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">writeExample</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	str <span class="token operator">:=</span> <span class="token string">`&lt;html&gt;</span>
<span class="line">&lt;head&gt;&lt;title&gt;Go Web&lt;/title&gt;&lt;/head&gt;</span>
<span class="line">&lt;body&gt;&lt;h1&gt;Hello World&lt;/h1&gt;&lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line">`</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/write&quot;</span><span class="token punctuation">,</span> writeExample<span class="token punctuation">)</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-i</span> localhost:8080/write</span>
<span class="line"></span>
<span class="line"><span class="token comment"># HTTP/1.1 200 OK</span></span>
<span class="line"><span class="token comment"># Date: Sun, 15 Oct 2023 08:38:27 GMT</span></span>
<span class="line"><span class="token comment"># Content-Length: 84</span></span>
<span class="line"><span class="token comment"># Content-Type: text/html; charset=utf-8</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># &lt;html&gt;</span></span>
<span class="line"><span class="token comment"># &lt;head&gt;&lt;title&gt;Go Web&lt;/title&gt;&lt;/head&gt;</span></span>
<span class="line"><span class="token comment"># &lt;body&gt;&lt;h1&gt;Hello World&lt;/h1&gt;&lt;/body&gt;</span></span>
<span class="line"><span class="token comment"># &lt;/html&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="writeheader-方法" tabindex="-1"><a class="header-anchor" href="#writeheader-方法"><span>WriteHeader 方法</span></a></h4><ul><li>WriteHeader 方法接收一个整数类型（HTTP 状态码）作为参数，并把它作为 HTTP 响应的状态码返回</li><li>如果该方法没有显示调用，那么在第一次调用 Write 方法前，会隐式地调用 WriteHeader(http.StatusOK) <ul><li>所以 WriteHeader 主要用来发送错误类的 HTTP 状态码</li></ul></li><li>调用完 WriteHeader 方法之后，仍然可以写入到 ResponseWriter，但无法再修改 header 了</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">writeHeaderExample</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">501</span><span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;No such service, try next door&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/writeheader&quot;</span><span class="token punctuation">,</span> writeHeaderExample<span class="token punctuation">)</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-i</span> localhost:8080/writeheader</span>
<span class="line"></span>
<span class="line"><span class="token comment"># HTTP/1.1 501 Not Implemented</span></span>
<span class="line"><span class="token comment"># Date: Sun, 15 Oct 2023 12:44:53 GMT</span></span>
<span class="line"><span class="token comment"># Content-Length: 31</span></span>
<span class="line"><span class="token comment"># Content-Type: text/plain; charset=utf-8</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># No such service, try next door</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="header-方法" tabindex="-1"><a class="header-anchor" href="#header-方法"><span>Header 方法</span></a></h4><ul><li>Header 方法返回 headers 的 map，可以进行修改</li><li>修改后的 headers 将会体现在返回给客户端的 HTTP 响应里</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	User <span class="token builtin">string</span></span>
<span class="line">	Threads <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">headerExample</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://google.com&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">jsonExample</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	post <span class="token operator">:=</span> <span class="token operator">&amp;</span>Post<span class="token punctuation">{</span></span>
<span class="line">		User<span class="token punctuation">:</span> <span class="token string">&quot;Sau Sheong&quot;</span><span class="token punctuation">,</span></span>
<span class="line">		Threads<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;third&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	json<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span></span>
<span class="line">	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/header&quot;</span><span class="token punctuation">,</span> headerExample<span class="token punctuation">)</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/json&quot;</span><span class="token punctuation">,</span> jsonExample<span class="token punctuation">)</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-i</span> localhost:8080/header</span>
<span class="line"></span>
<span class="line"><span class="token comment"># HTTP/1.1 302 Found</span></span>
<span class="line"><span class="token comment"># Location: http://google.com</span></span>
<span class="line"><span class="token comment"># Date: Sun, 15 Oct 2023 12:50:47 GMT</span></span>
<span class="line"><span class="token comment"># Content-Length: 0</span></span>
<span class="line"></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-i</span> localhost:8080/json</span>
<span class="line"></span>
<span class="line"><span class="token comment"># HTTP/1.1 200 OK</span></span>
<span class="line"><span class="token comment"># Content-Type: application/json</span></span>
<span class="line"><span class="token comment"># Date: Sun, 15 Oct 2023 12:56:51 GMT</span></span>
<span class="line"><span class="token comment"># Content-Length: 58</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># {&quot;User&quot;:&quot;Sau Sheong&quot;,&quot;Threads&quot;:[&quot;first&quot;,&quot;second&quot;,&quot;third&quot;]}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="内置的-response" tabindex="-1"><a class="header-anchor" href="#内置的-response"><span>内置的 Response</span></a></h4><ul><li>NotFound 函数，包装一个 404 状态码和一个额外的信息</li><li>ServeFile 函数，从文件系统提供文件，返回给请求者</li><li>ServeContent 函数，它可以把实现了 io.ReadSeeker 接口的任何东西里面的内容返回给请求者 <ul><li>还可以处理 Range 请求（范围请求），如果只请求了资源的一部分内容，那么 ServeContent 就可以如此响应。而 ServeFile 或 io.Copy 就不行</li></ul></li><li>Redirect 函数，告诉客户端重定向到另一个 URL</li></ul><h3 id="模板" tabindex="-1"><a class="header-anchor" href="#模板"><span>模板</span></a></h3><ul><li>Web 模板就是预先设计好的 HTML 页面，它可以被模板引擎反复的使用，来产生 HTML 页面</li><li>Go 的标准库提供了 text/template 和 html/template 两个模板库 <ul><li>大多数 Go 的 Web 框架都使用这些库作为默认的模板引擎</li></ul></li></ul><p><strong>模板与模板引擎</strong></p><p>模板引擎可以合并模板与上下文数据，产生最终的 HTML</p><p><strong>Go 的模板引擎</strong></p><ul><li>主要使用的是 text/template，HTML 相关的部分使用了 html/template，是个混合体</li><li>模板可以完全无逻辑，但又具有足够的嵌入特性</li><li>和大多数模板引擎一样，Go Web 的模板位于无逻辑和嵌入逻辑之间的某个地方</li></ul><p><strong>关于模板</strong></p><ul><li>模板必须是可读的文本格式，扩展名任意。对于 Web 应用通常就是 HTML <ul><li>里面会内嵌一些命令（叫作 action）</li></ul></li><li>text/template 是通用模板引擎，html/template 是 HTML 模板引擎</li><li>action 位于双层花括号之间：<code>{{ . }}</code><ul><li>这里的 . 就是一个 action</li><li>它可以命令模板引擎将其替换成一个值</li></ul></li></ul><p><strong>使用模板引擎</strong></p><ol><li>解析模板源（可以是字符串或模板文件），从而创建一个解析好的模板的 struct</li><li>执行解析好的模板，并传入 ResponseWriter 和数据 <ul><li>这会触发模板引擎组合解析好的模板和数据，来产生最终的 HTML，并将它传递给 ResponseWriter</li></ul></li></ol><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    {{ . }}</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span></span>
<span class="line">		Addr<span class="token punctuation">:</span> <span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">)</span></span>
<span class="line">	server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="解析模板" tabindex="-1"><a class="header-anchor" href="#解析模板"><span>解析模板</span></a></h4><ul><li>ParseFiles</li><li>ParseGlob</li><li>Parse</li></ul><p><strong>ParseFiles</strong></p><ul><li>解析模板文件，并创建一个解析好的模板 struct，后续可以被执行</li><li>ParseFiles 函数是 Template struct 上 ParseFiles 方法的简便调用</li><li>调用 ParseFiles 后，会创建一个新的模板，模板名字是文件名</li><li>New 函数</li><li>ParseFiles 的参数数量可变，但只返回一个模板 <ul><li>当解析多个文件时，第一个文件作为返回的模板（名，内容），其余的作为 map，供后续执行使用</li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token comment">// t, _ := template.ParseFiles(&quot;tmpl.html&quot;)</span></span>
<span class="line">t <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>ParseGlob</strong></p><ul><li>使用模式匹配来解析特定的文件</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line">t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseGlob</span><span class="token punctuation">(</span><span class="token string">&quot;*.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>Parse</strong></p><ul><li>可以解析字符串模板，其他方式最终都会调用 Parse</li></ul><p><strong>Lookup</strong></p><ul><li>通过模板名来寻找模板，如果没找到就返回 nil</li></ul><p><strong>Must</strong></p><ul><li>可以包裹一个函数，返回到一个模板的指针和一个错误 <ul><li>如果错误不为 nil，那么就 panic</li></ul></li></ul><h4 id="执行模板" tabindex="-1"><a class="header-anchor" href="#执行模板"><span>执行模板</span></a></h4><ul><li>Execute <ul><li>参数是 ResponseWriter、数据</li><li>单模板：很适用</li><li>模板集：只用第一个模板</li></ul></li><li>ExecuteTemplate <ul><li>参数是 ResponseWriter、模板名、数据</li><li>模板集：很适用</li></ul></li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;t1.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">	ts<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;t2.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t3.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	ts<span class="token punctuation">.</span><span class="token function">ExecuteTemplate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;t2.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><h4 id="action" tabindex="-1"><a class="header-anchor" href="#action"><span>Action</span></a></h4><ul><li>Action 就是 Go 模板中嵌入的命令，位于两组花括号之间 </li><li>. 就是一个 Action，而且是最重要的一个。它代表了传入模板的数据</li><li>Action 主要可以分为 5 类 <ul><li>条件类</li><li>迭代/遍历类</li><li>设置类</li><li>包含类</li><li>定义类</li></ul></li></ul><p><strong>条件 Action</strong></p><p>语法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">if</span> arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">if</span> arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">else</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">if</span> arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">else</span> <span class="token keyword">if</span> arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">else</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content</span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p>demo</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  {{ if . }} Number is greater than 5 {{ else }} Number is 5 or less {{ end }}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">)</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> rng <span class="token operator">=</span> rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>迭代/遍历 Action</strong></p><p>语法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">range</span> array <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">	some content <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>这类 Action 用来遍历数组、slice、map 或 channel 等数据结构 <ul><li>“.” 用来表示每次迭代循环中的元素</li></ul></li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  {{range .}}</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{{.}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!-- 回落机制 --&gt;</span></span>
<span class="line">  {{ else }}</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Empty list<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  {{end}}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/process&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">)</span></span>
<span class="line">	http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	daysOfWeek <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Mon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Wed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Thu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Fri&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sun&quot;</span><span class="token punctuation">}</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> daysOfWeek<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>设置 Action</strong></p><p>语法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> with arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">.</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>它允许在指定范围内，让“.”来表示其它指定的值（arg）</li></ul><p>demo</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>The dot is set to {{ . }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ with &quot;world&quot; }} Now the dot is set to {{ . }} {{ end }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>The dot is {{ . }} again<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!-- 回落机制 --&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>The dot is set to {{ . }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    {{ with &quot;&quot; }} Now the dot is set to {{ . }} {{ else }} The dot is still {{ .</span>
<span class="line">    }} {{ end }}</span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>The dot is {{ . }} again<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>包含 Action</strong></p><p>语法</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> template <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 给被包含的模板传递参数</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> template <span class="token string">&quot;name&quot;</span> arg <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><ul><li>它允许在模板中包含其他的模板</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>this is t1.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>This is the value of the dot in t1.html - [{{ . }}]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    {{ template &quot;t2.html&quot; . }}</span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>This is t1.html after<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> yellow</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  This is t2.html <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">  This is the value of the dot in t2.html - [{{ . }}]</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	t<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;tmpl.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t2.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>定义 Action</strong></p><p>define action</p><h4 id="函数和管道" tabindex="-1"><a class="header-anchor" href="#函数和管道"><span>函数和管道</span></a></h4><p><strong>参数</strong></p><ul><li>参数就是模板里面用到的值</li><li>模板里面的参数可以是任何类型的值</li><li>参数可以是变量、方法（返回单个值或返回一个值和一个错误）或函数</li><li>参数可以是一个“.”，也就是传入到模板引擎的那个值</li></ul><p><strong>在 Action 中设置变量</strong></p><ul><li>可以在 action 中设置变量，变量以 $ 开头： <ul><li>$variable := value</li></ul></li><li>一个迭代 action 的例子</li></ul><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">range</span> $key<span class="token punctuation">,</span> $value <span class="token operator">:=</span> <span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> $key <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> $value <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>管道</strong></p><ul><li>管道是按顺序连接到一起的参数、函数和方法 <ul><li>和 Unix 的管道类似</li></ul></li><li>例如：<code>{{ p1 | p2 | p3 }}</code><ul><li>p1、p2、p3 要么是参数，要么是函数</li></ul></li><li>管道允许把参数的输出发给下一个参数，下一个参数由管道（|）分隔开</li></ul><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!-- 展示 12.35 --&gt;</span></span>
<span class="line">  {{ 12.3456 | printf &quot;%.2f&quot; }}</span>
<span class="line">  <span class="token comment">&lt;!-- 等价于 --&gt;</span></span>
<span class="line">  {{ printf &quot;%.2f&quot; 12.3456 }}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><p><strong>函数</strong></p><ul><li>参数可以是一个函数</li><li>Go 模板引擎提供了一些基本的内置函数，功能比较有限。例如 fmt.Sprint 的各类变体</li><li>开发者可以自定义函数 <ul><li>可以接收任意数量的输入参数</li><li>返回： <ul><li>一个值</li><li>一个值 + 一个错误</li></ul></li></ul></li></ul><p><strong>内置函数</strong></p><ul><li>define\template\block</li><li>html\js\urlquery。对字符串进行转义，防止安全问题 <ul><li>如果是 Web 模板，那么不会需要经常使用这些函数</li></ul></li><li>index</li><li>print/printf/println</li><li>len</li><li>with</li></ul><p><strong>自定义函数</strong></p><p><code>template.Funcs(funcMap FuncMap) *Template</code></p><p><code>type FuncMap map[string]interface{}</code></p><p>创建自定义函数的步骤：</p><ol><li>创建一个 FuncMap 类型的变量 <ul><li>key 是函数名</li><li>value 就是函数</li></ul></li><li>把 FuncMap 附加到模板</li></ol><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!-- 自定义函数可以在管道中使用，更强大灵活 --&gt;</span></span>
<span class="line">  {{ . | fdate }}</span>
<span class="line">  <span class="token comment">&lt;!-- 自定义函数也可以作为正常函数使用 --&gt;</span></span>
<span class="line">  {{ fdate . }}</span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go"><pre><code class="language-go"><span class="line"><span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">// 常见用法：</span></span>
<span class="line">	<span class="token comment">// template.New(&quot;&quot;).Funcs(funcMap).Parse(...)</span></span>
<span class="line">	<span class="token comment">// 调用顺序十分重要</span></span>
<span class="line">	funcMap <span class="token operator">:=</span> template<span class="token punctuation">.</span>FuncMap<span class="token punctuation">{</span><span class="token string">&quot;fdate&quot;</span><span class="token punctuation">:</span> formatDate<span class="token punctuation">}</span></span>
<span class="line">	t<span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Funcs</span><span class="token punctuation">(</span>funcMap<span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">formatDate</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	layout <span class="token operator">:=</span> <span class="token string">&quot;2006-01-02&quot;</span></span>
<span class="line">	<span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新：: </span><time class="meta-item-info" datetime="2025-05-28T10:37:47.000Z" data-allow-mismatch>2025/5/28 10:37</time></div><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/study-notes/assets/app-D9fezM6y.js" defer></script>
  </body>
</html>
